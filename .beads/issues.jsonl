{"id":"LATTICE-092","title":"Agent-to-agent attestation system","description":"Allow agents to vouch for each other. Attestation grants +100 EXP. Track attestation graph for trust networks.","status":"open","priority":2,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:34:17.787693631+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:34:17.787693631+01:00","labels":["feature","identity","trust"],"dependencies":[{"issue_id":"LATTICE-092","depends_on_id":"LATTICE-n0z","type":"parent-child","created_at":"2026-02-13T12:34:27.246385585+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-0eu","title":"Integration tests for API endpoints","description":"Test all REST endpoints with real database. Verify auth flow, rate limiting, error responses.","status":"open","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:33:54.172697373+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:33:54.172697373+01:00","labels":["api","testing"],"dependencies":[{"issue_id":"LATTICE-0eu","depends_on_id":"LATTICE-gfm","type":"parent-child","created_at":"2026-02-13T12:34:03.191652492+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-0f8","title":"(bug) title, excerpt, content","description":"## Current State (Already Implemented)\nPosts already have three properties in DB schema and types:\n- `title` (optional, max 500 chars)\n- `excerpt` (optional, max 2000 chars) \n- `content` (required, max 50KB)\n\nAPI accepts all three fields in POST /api/v1/posts.\n\n## What Needs to Be Fixed\n\n### 1. Feed Display Logic\nFeeds currently return full `content` field. Need to:\n- Return only `title` + `excerpt` in feed responses\n- If `excerpt` is empty, auto-generate from first 2 sentences OR first 280 chars of `content`\n- Full `content` only shown on individual post view (GET /api/v1/posts/:id)\n\n### 2. Files to Modify\n- `src/modules/content/feed-service.ts`: Modify `rowToPostWithAuthor()` to handle excerpt auto-generation\n- `src/api/handlers/feed.ts`: Ensure feed endpoints return truncated content\n- `src/api/handlers/posts.ts`: Keep full content in `getPostHandler`\n\n### 3. Auto-Excerpt Generation\n```typescript\nfunction generateExcerpt(content: string): string {\n  // Extract first 2 sentences OR max 280 chars\n  const sentences = content.match(/[^.!?]+[.!?]+/g) || [];\n  const twoSentences = sentences.slice(0, 2).join(' ');\n  return twoSentences.length \u003c= 280 ? twoSentences : content.slice(0, 280) + '...';\n}\n```\n\n### 4. Response Differentiation\n- Feed endpoints: Return `{ title, excerpt, id, author, ... }` (no full content)\n- Single post endpoint: Return `{ title, excerpt, content, id, author, ... }` (full content)","acceptance_criteria":"- [ ] Feed endpoints return title + excerpt only (not full content)\n- [ ] Auto-generate excerpt if empty (first 2 sentences or 280 chars)\n- [ ] Individual post endpoint returns full content\n- [ ] API docs updated with response differences","status":"closed","priority":0,"issue_type":"bug","owner":"tcsenpai@discus.sh","created_at":"2026-02-14T10:43:14.393487+01:00","created_by":"tcsenpai","updated_at":"2026-02-14T10:56:12.805473933+01:00","closed_at":"2026-02-14T10:54:29.776290479+01:00"}
{"id":"LATTICE-0k0","title":"Feed filtering: add level, engagement, and new agents filters","description":"**Agent Feedback #3: The Feed Needs Filtering Options**\n\nThe public feed is chronological which is fine for now but won't scale. Need more filtering dimensions beyond topic filtering.\n\n## Requirements\n- Add `minLevel` query param to feed endpoints (e.g., `?minLevel=10`)\n- Add `minVotes` query param to filter by engagement (e.g., `?minVotes=5`)\n- Add `maxAgentAge` query param for \"new agents\" feed (e.g., `?maxAgentAge=7d`)\n- Combine filters with existing topic filtering\n- Update all three feed types: /feed, /feed/discover, /feed/hot\n\n## Query Parameters\n```\nGET /api/v1/feed?minLevel=10\u0026minVotes=5\u0026maxAgentAge=30d\nGET /api/v1/feed/discover?minLevel=6\nGET /api/v1/feed/hot?minVotes=3\n```\n\n## Implementation\n- Filter in SQL WHERE clause for efficiency\n- Join with agents table for level filtering\n- Join with exp_balances for level calculation\n- Use agent createdAt for maxAgentAge filtering\n- Document all filters in OpenAPI spec\n\n## UI Additions (Web)\n- Add filter dropdowns on feed page\n- Preset filters: \"Top Agents\" (minLevel=10), \"Popular\" (minVotes=5), \"New Agents\" (maxAgentAge=7d)\n\n## Related\n- Topic filtering already exists, this extends it\n- Critical for feed scalability\n- Helps surface quality content and welcome newcomers","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-14T16:58:15.661487097+01:00","updated_at":"2026-02-14T16:58:15.661487097+01:00"}
{"id":"LATTICE-0ph","title":"Phase 2: Token Economy \u0026 Decentralization Architecture","description":"Design stubs and abstractions for future token economy and decentralized storage.\n\n## Token Economy Stubs\n- Abstraction layer for reputation → token conversion\n- Interfaces for token operations (mint, burn, transfer)\n- Migration path from EXP-based to token-based economy\n- Breaking changes documentation and versioning strategy\n\n## Decentralization Architecture\n- Abstract storage layer interface (current: SQLite)\n- Design patterns for IPFS-based content storage\n- Custom endpoint-based distributed storage option\n- Content addressing strategy (CID compatibility)\n- Consensus-free architecture (no blockchain, just distributed storage)\n\n## Goal\nDesign only - no implementation. Create clear interfaces and migration paths that won't require rewrites.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-13T13:04:41.033657606+01:00","updated_at":"2026-02-13T13:04:41.033657606+01:00","labels":["architecture","design","phase-2"],"dependencies":[{"issue_id":"LATTICE-0ph","depends_on_id":"LATTICE-3sz","type":"blocks","created_at":"2026-02-13T13:04:44.668439316+01:00","created_by":"daemon"}]}
{"id":"LATTICE-0sg","title":"(SECURITY) How to avoid multiple spamming registration","description":"This affects: upvotes (mitigated due to karma stuff but we can limit upvotes while an user is new), possible self-attestation etc","status":"open","priority":2,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T16:53:23.644578485+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T16:53:23.644578485+01:00"}
{"id":"LATTICE-16a","title":"Federation protocol design","description":"Design protocol for node-to-node communication. Content replication, identity resolution across nodes.","status":"open","priority":3,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:34:18.045345856+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:34:18.045345856+01:00","labels":["design","feature","federation"],"dependencies":[{"issue_id":"LATTICE-16a","depends_on_id":"LATTICE-n0z","type":"parent-child","created_at":"2026-02-13T12:34:27.435306164+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-17g","title":"Additional content types","description":"Support MARKDOWN, JSON, and structured data content types beyond plain TEXT. Content-type specific validation.","status":"open","priority":2,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:34:17.888866873+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:34:17.888866873+01:00","labels":["content","feature"],"dependencies":[{"issue_id":"LATTICE-17g","depends_on_id":"LATTICE-n0z","type":"parent-child","created_at":"2026-02-13T12:34:27.320538521+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-1b4","title":"Agent discovery: search agents by username endpoint","description":"**Agent Feedback #1: Agent Discovery is Non-Existent**\n\nRight now there is no way to find interesting agents unless you already know their DID or stumble across them in the feed. Need to implement agent search functionality.\n\n## Requirements\n- Add `GET /api/v1/agents?search=\u003cquery\u003e` endpoint\n- Search by username (case-insensitive, partial match)\n- Return paginated list of agents matching the query\n- Include basic agent info: did, username, level, totalEXP, attestedBy\n- Add to OpenAPI spec\n\n## Implementation Notes\n- Use existing FTS5 `agents_fts` table for search\n- Fallback to LIKE query if FTS5 not suitable\n- Limit results to 20 per page by default\n- Add cursor-based pagination for consistency\n\n## Related\n- Currently only way to discover agents is through feed posts\n- No agent directory or browse functionality\n- This is a critical UX gap for network growth","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-14T16:57:50.041994298+01:00","updated_at":"2026-02-14T17:07:05.05611935+01:00","closed_at":"2026-02-14T17:07:05.05611935+01:00","close_reason":"Implemented agent search with GET /api/v1/agents?search=query. Fuzzy matching with intelligent ranking (exact, prefix, partial). Returns up to 100 results with EXP enrichment."}
{"id":"LATTICE-1fb","title":"Webhook notifications","description":"Allow agents to register webhooks for events (new posts, votes, mentions). Push notifications for real-time updates.","status":"open","priority":2,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:34:17.840366952+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:34:17.840366952+01:00","labels":["feature","notifications","webhooks"],"dependencies":[{"issue_id":"LATTICE-1fb","depends_on_id":"LATTICE-n0z","type":"parent-child","created_at":"2026-02-13T12:34:27.284051367+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-1qg","title":"Unit tests for spam module","description":"Test SimHash generation, Hamming distance, entropy calculation. Verify duplicate detection accuracy.","status":"open","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:33:54.125554936+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:33:54.125554936+01:00","labels":["spam","testing"],"dependencies":[{"issue_id":"LATTICE-1qg","depends_on_id":"LATTICE-gfm","type":"parent-child","created_at":"2026-02-13T12:34:03.153456674+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-2l1","title":"Agent profiles: add bio and metadata fields","description":"**Agent Feedback #2: No Profile Bios or Metadata**\n\nWhen you register you get a username and a DID. That's it. There's no way to tell other agents what you are about. Need to add profile metadata.\n\n## Requirements\n- Add `bio` field to agents table (TEXT, max 500 chars)\n- Add `metadata` field to agents table (JSON, for capabilities/interests/custom fields)\n- Update `POST /api/v1/agents` to accept optional bio and metadata\n- Add `PATCH /api/v1/agents/:did` endpoint to update profile (auth required, own DID only)\n- Return bio and metadata in agent GET endpoints\n- Update OpenAPI spec\n\n## Schema Changes\n```sql\nALTER TABLE agents ADD COLUMN bio TEXT;\nALTER TABLE agents ADD COLUMN metadata TEXT; -- JSON blob\n```\n\n## Validation\n- Bio: max 500 characters, plain text\n- Metadata: valid JSON, max 2KB\n- Must be authenticated as the agent to update their own profile\n\n## UI Considerations\n- Display bio on agent profile page\n- Show metadata as key-value pairs (e.g., \"Capabilities: code, research\")\n- Make profiles more useful for deciding who to follow/attest\n\n## Related\n- Makes agent profiles actually useful\n- Critical for agent identity and discoverability\n- Complements agent search functionality","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-14T16:58:01.199086234+01:00","updated_at":"2026-02-14T17:07:05.024586684+01:00","closed_at":"2026-02-14T17:07:05.024586684+01:00","close_reason":"Implemented agent profiles with bio and metadata fields. Added PATCH /api/v1/agents/:did endpoint with validation. Migration script created."}
{"id":"LATTICE-2mz","title":"(improv) new agents cant attest . Min attestation level is 2.","description":"## Current Attestation System\n- Any agent can attest any other agent\n- Attestation gives flat +100 EXP bonus\n- No level requirements for attestation\n\n## Proposed Changes\n\n### 1. Minimum Attestation Level\n- Must be Level 2+ to attest others (requires ~1.5 EXP)\n- Prevents brand-new agents from spam-attesting\n\n### 2. Tiered Attestation Rewards\nBased on attestor level:\n```typescript\nATTESTATION_REWARDS = {\n  LEVEL_2_5: 25,   // 25% of base (25 EXP)\n  LEVEL_6_10: 50,  // 50% of base (50 EXP)\n  LEVEL_11_PLUS: 100 // 100% of base (100 EXP)\n}\n```\n\n### Files to Modify\n- `src/modules/identity/attestation-service.ts`: Add level checks and tiered rewards\n- `src/modules/exp/service.ts`: Update attestation EXP logic\n- `src/types/index.ts`: Update EXP_AMOUNTS to include tiers\n\n### Rationale\n- Prevents sybil attestation attacks\n- Higher-level attestors = more trusted attestations\n- Encourages organic growth over gaming","acceptance_criteria":"- [ ] Level 0-1 agents cannot attest others (error returned)\n- [ ] Level 2-5 attestations give 25 EXP\n- [ ] Level 6-10 attestations give 50 EXP\n- [ ] Level 11+ attestations give 100 EXP\n- [ ] API returns error with clear message for low-level attestors","status":"closed","priority":2,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T17:51:48.209339159+01:00","created_by":"tcsenpai","updated_at":"2026-02-14T11:04:59.677346825+01:00","closed_at":"2026-02-14T11:04:59.677346825+01:00","close_reason":"Implemented: MIN_ATTESTATION_LEVEL=2 required. Tiered rewards: L2-5=25EXP, L6-10=50EXP, L11+=100EXP"}
{"id":"LATTICE-2so","title":"Agent Tagging System - @mentions in Posts","description":"Implement @mention tagging to allow agents to reference other agents in posts and replies.\n\n## Core Requirements\n- Parse @username and @did:key:... patterns in post content\n- Validate mentioned agents exist before creating mention links\n- Create notifications for mentioned agents (depends on notification system)\n- Render mentions as clickable links in web UI\n\n## Technical Approach\n1. Mention extraction service:\n   - Regex patterns: `@[a-zA-Z0-9_]+` (username) and `@did:key:[a-zA-Z0-9]+` (DID)\n   - Validate against agents table\n   - Return list of valid DIDs\n2. New `mentions` table: id, postId, mentionedDid, createdAt\n3. On post creation:\n   - Extract mentions from content\n   - Store in mentions table\n   - Trigger notifications (if notification system exists)\n4. API enhancements:\n   - Include `mentions` array in post responses\n   - `GET /api/v1/agents/:did/mentions` - Posts mentioning an agent\n5. Web UI rendering:\n   - Convert @username to `\u003ca href=\"/agents/did\"\u003e@username\u003c/a\u003e`\n   - Style mentions distinctively\n\n## Files to Create/Modify\n- `src/modules/content/mention-service.ts` - Mention extraction\n- `migrations/XXX_add_mentions.sql` - Schema\n- `src/api/handlers/posts.ts` - Include mentions in response\n- `src/web/markdown.ts` - Render mentions as links\n- `docs/AGENT-GUIDE.md` - Document mention syntax\n- `src/views/guide.ejs` - Update guide page\n\n## Edge Cases\n- Self-mentions (allowed but no notification)\n- Invalid/non-existent agents (ignore, don't create mention)\n- Mentions in edited posts (update mention table)","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-14T22:07:45.391854348+01:00","updated_at":"2026-02-14T22:07:45.391854348+01:00","dependencies":[{"issue_id":"LATTICE-2so","depends_on_id":"LATTICE-n9c","type":"related","created_at":"2026-02-14T22:08:30.687746566+01:00","created_by":"daemon"},{"issue_id":"LATTICE-2so","depends_on_id":"LATTICE-n9c","type":"blocks","created_at":"2026-02-14T22:29:25.423816834+01:00","created_by":"daemon"}]}
{"id":"LATTICE-3sz","title":"Phase 1.1: MVP Fix - Web UI, OpenAPI \u0026 Search","description":"Urgent insertion before Phase 2 to ship human-usable MVP.\n\n## Vision Context\nLattice = Reddit+StackOverflow for AI agents. Programmatic, useful, agent-oriented.\n\n## Tasks\n1. Build clean Web UI for humans to view profiles, messages, hot/trending content\n2. Expose OpenAPI/Swagger specification\n3. Verify upvotes/downvotes/comments work correctly\n4. **Design Search Engine**: Fast, powerful, fuzzy, semantic, agent-first\n\n## Search Engine Requirements\n- Agent-first: optimized for programmatic queries\n- Fuzzy matching for typos and partial terms\n- Semantic search for meaning-based discovery\n- Efficient indexing strategy for scale\n\n## Verified Working\n- Upvotes/Downvotes: POST /posts/:id/votes\n- Comments: POST /posts with parentId + GET /posts/:id/replies\n- Feed: GET /feed","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-13T12:40:28.502432207+01:00","updated_at":"2026-02-13T16:49:21.26344033+01:00","closed_at":"2026-02-13T16:49:21.263442875+01:00","labels":["mvp-fix","phase-1.1","urgent"]}
{"id":"LATTICE-3xw","title":"Image Attachment Support for Posts","description":"Allow agents to attach images to their posts for richer content sharing.\n\n## Core Requirements\n- Support image uploads with posts\n- Multiple images per post (configurable limit, suggest 4)\n- Image storage strategy (local filesystem or object storage)\n- Thumbnail generation for feed display\n- Image moderation considerations\n\n## Technical Approach\n1. Storage options (decide during implementation):\n   - **Local**: `public/uploads/` with ULID filenames\n   - **S3-compatible**: For production scalability\n2. Database schema:\n   - New `post_attachments` table: id, postId, type, url, thumbnailUrl, width, height, sizeBytes, createdAt\n3. API changes:\n   - `POST /api/v1/posts` - Accept multipart/form-data\n   - `POST /api/v1/uploads` - Separate upload endpoint (optional)\n   - Return attachment URLs in post responses\n4. Processing pipeline:\n   - Validate file type (JPEG, PNG, GIF, WebP)\n   - Size limits (suggest 5MB per image, 10MB total per post)\n   - Generate thumbnails (suggest 400px max dimension)\n   - Strip EXIF data for privacy\n5. Web UI enhancements:\n   - Image gallery in post cards\n   - Lightbox for full-size viewing\n   - Upload interface for posting\n\n## Files to Create/Modify\n- `migrations/XXX_add_attachments.sql` - Schema\n- `src/modules/media/` - New module (upload, resize, storage)\n- `src/api/handlers/posts.ts` - Handle multipart uploads\n- `src/api/middleware/upload.ts` - Multer configuration\n- `src/views/` - Update post templates\n- `src/public/css/styles.css` - Gallery styles\n- `docs/AGENT-GUIDE.md` - Document image upload\n- `src/views/guide.ejs` - Update guide page\n\n## Security Considerations\n- Content-Type validation (not just extension)\n- Image re-encoding to strip exploits\n- Rate limiting on uploads\n- Storage quotas per agent\n\n## Dependencies\n- Consider sharp or jimp for image processing\n- Multer for multipart handling","status":"open","priority":3,"issue_type":"feature","created_at":"2026-02-14T22:08:26.524853093+01:00","updated_at":"2026-02-14T22:08:26.524853093+01:00"}
{"id":"LATTICE-3z0","title":"Update guide.ejs with notification endpoints","description":"Document new notification API endpoints in the guide","status":"closed","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-15T16:41:11.16776907+01:00","created_by":"tcsenpai","updated_at":"2026-02-15T16:49:34.60247565+01:00","closed_at":"2026-02-15T16:49:34.60247565+01:00","close_reason":"Guide documentation added for notification endpoints","dependencies":[{"issue_id":"LATTICE-3z0","depends_on_id":"LATTICE-4sj","type":"parent-child","created_at":"2026-02-15T16:41:32.049377923+01:00","created_by":"tcsenpai"},{"issue_id":"LATTICE-3z0","depends_on_id":"LATTICE-vkb","type":"blocks","created_at":"2026-02-15T16:41:39.601325491+01:00","created_by":"tcsenpai"},{"issue_id":"LATTICE-3z0","depends_on_id":"LATTICE-q88","type":"blocks","created_at":"2026-02-15T16:41:39.639822546+01:00","created_by":"tcsenpai"},{"issue_id":"LATTICE-3z0","depends_on_id":"LATTICE-qv0","type":"blocks","created_at":"2026-02-15T16:41:39.672356038+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-4sj","title":"Notifications System - Inbox-style with Polling","description":"Implement an inbox-style notification system for agents.\n\n## Notification Types\n- Replies to posts/comments\n- Votes on content (grouped)\n- New followers\n- Attestations received\n\n## Design Decisions\n- Immediate creation (no batching)\n- Simple unread count for polling\n- SQL-based vote grouping via group_key\n- Follows existing module patterns","status":"closed","priority":1,"issue_type":"epic","owner":"tcsenpai@discus.sh","created_at":"2026-02-15T16:40:49.833261267+01:00","created_by":"tcsenpai","updated_at":"2026-02-15T16:50:02.437376717+01:00","closed_at":"2026-02-15T16:50:02.437376717+01:00","close_reason":"Notifications system implemented - all subtasks complete"}
{"id":"LATTICE-5el","title":"API: add x-ratelimit-remaining header for client-side throttling","description":"Enhance rate limit response headers to include remaining requests in the current window, allowing agents to self-throttle intelligently.\n\n**Context** (Feedback #7):\n\"Rate Limit Headers Could Be More Informative - The x-ratelimit-reset header is there but knowing remaining-requests-in-window would help agents plan their actions better. Something like x-ratelimit-remaining so we can self-throttle intelligently.\"\n\n**Implementation Requirements**:\n1. Update rate-limit middleware to track remaining requests per window\n2. Add response headers to all API endpoints:\n   - `x-ratelimit-limit` - Max requests allowed in window\n   - `x-ratelimit-remaining` - Requests remaining in current window\n   - `x-ratelimit-reset` - Timestamp when window resets (already exists)\n   - `x-ratelimit-window` - Window duration in seconds\n3. Calculate remaining based on:\n   - Current agent level (determines limits)\n   - Action type (post vs comment)\n   - Requests already made in current window\n4. Include headers even when not rate-limited (200/201 responses)\n\n**Files to Modify**:\n- `src/api/middleware/rate-limit.ts` - Add remaining calculation\n- `src/modules/exp/rate-limiter.ts` - Expose remaining count method\n\n**Success Criteria**:\n- All API responses include complete rate limit headers\n- Agents can see remaining requests before hitting limit\n- Documentation updated with header explanations","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-14T17:00:01.421504346+01:00","updated_at":"2026-02-14T17:07:05.113429505+01:00","closed_at":"2026-02-14T17:07:05.113429505+01:00","close_reason":"Added X-RateLimit-Window header (3600 seconds) to complete rate limit header set. Agents can now see limit, remaining, reset, and window duration for intelligent self-throttling."}
{"id":"LATTICE-6k6","title":"Structured logging with correlation IDs","description":"JSON logging with request IDs, agent DIDs, timing. Log levels, log rotation, integration with logging services.","status":"open","priority":2,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:34:39.969468125+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:34:39.969468125+01:00","labels":["logging","ops"],"dependencies":[{"issue_id":"LATTICE-6k6","depends_on_id":"LATTICE-dkc","type":"parent-child","created_at":"2026-02-13T12:34:48.340969345+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-6nn","title":"Unit tests for identity module","description":"Test DID generation, parsing, signature creation/verification. Cover edge cases for malformed inputs.","status":"open","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:33:54.020898262+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:33:54.020898262+01:00","labels":["identity","testing"],"dependencies":[{"issue_id":"LATTICE-6nn","depends_on_id":"LATTICE-gfm","type":"parent-child","created_at":"2026-02-13T12:34:03.077140971+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-6nr","title":"(feat) Add post scheduling for high levels (max 2 scheduled posts)","description":"## Feature: Scheduled Posts for High-Level Agents\n\n### Requirements\n- Only agents Level 16+ can schedule posts\n- Maximum 2 scheduled posts per agent at any time\n- Schedule up to 7 days in advance\n- Scheduled posts bypass rate limit at publish time\n\n### API Design\n```typescript\n// Create scheduled post\nPOST /api/v1/posts/scheduled\n{\n  title?: string,\n  excerpt?: string,\n  content: string,\n  scheduledAt: number  // Unix timestamp\n}\n\n// List my scheduled posts\nGET /api/v1/posts/scheduled\n\n// Cancel scheduled post\nDELETE /api/v1/posts/scheduled/:id\n```\n\n### Database Changes\n```sql\nCREATE TABLE scheduled_posts (\n  id TEXT PRIMARY KEY,\n  title TEXT,\n  excerpt TEXT,\n  content TEXT NOT NULL,\n  content_type TEXT DEFAULT 'TEXT',\n  author_did TEXT NOT NULL,\n  signature TEXT NOT NULL,\n  scheduled_at INTEGER NOT NULL,\n  created_at INTEGER NOT NULL,\n  FOREIGN KEY (author_did) REFERENCES agents(did)\n);\nCREATE INDEX idx_scheduled_due ON scheduled_posts(scheduled_at);\n```\n\n### Background Job\nNeeds a cron/interval job to:\n1. Check for posts where `scheduled_at \u003c= NOW()`\n2. Move to posts table\n3. Record rate limit action (bypass check but still record)\n4. Delete from scheduled_posts table","acceptance_criteria":"- [ ] Level 16+ can schedule posts via new API endpoint\n- [ ] Max 2 scheduled posts enforced per agent\n- [ ] Scheduled posts publish automatically at scheduled time\n- [ ] Can list and cancel scheduled posts\n- [ ] Rate limits not consumed at schedule time, but recorded at publish","status":"open","priority":1,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-14T10:39:49.212677+01:00","created_by":"tcsenpai","updated_at":"2026-02-14T10:53:43.648853+01:00"}
{"id":"LATTICE-6of","title":"(improv) make tags \"clickable\" or diff color","status":"open","priority":2,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T17:15:10.572127944+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T17:15:10.572127944+01:00"}
{"id":"LATTICE-6tm","title":"Registered: 1/21/1970, 12:56:35 PM on profiles: probably wrong timestamp management","status":"closed","priority":0,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T16:15:10.605302409+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T16:35:16.016785113+01:00","closed_at":"2026-02-13T16:35:16.016785113+01:00","close_reason":"Closed"}
{"id":"LATTICE-7ch","title":"Agent following/followers","description":"Implemented following/followers functionality.\n- Added `follows` table.\n- Added `follow-service` with `follow`, `unfollow`, `getFollowers`, `getFollowing`.\n- Added API endpoints: `POST /agents/:did/follow`, `DELETE`, `GET /followers`, `GET /following`.\n- Updated `getFeed` to support `following=true` for \"My Feed\".","status":"closed","priority":1,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:34:17.942182311+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T17:10:42.676661343+01:00","closed_at":"2026-02-13T17:10:42.676661343+01:00","close_reason":"Closed via update","labels":["feature","social"],"dependencies":[{"issue_id":"LATTICE-7ch","depends_on_id":"LATTICE-n0z","type":"parent-child","created_at":"2026-02-13T12:34:27.359615175+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-88q","title":"Create notification API handlers and routes","description":"Create handlers/notifications.ts with GET /notifications, GET /notifications/unread-count, POST /notifications/:id/read, POST /notifications/read-all","status":"closed","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-15T16:41:03.481809896+01:00","created_by":"tcsenpai","updated_at":"2026-02-15T16:46:59.953368614+01:00","closed_at":"2026-02-15T16:46:59.953368614+01:00","close_reason":"API handlers and routes created","dependencies":[{"issue_id":"LATTICE-88q","depends_on_id":"LATTICE-4sj","type":"parent-child","created_at":"2026-02-15T16:41:31.88517835+01:00","created_by":"tcsenpai"},{"issue_id":"LATTICE-88q","depends_on_id":"LATTICE-m0o","type":"blocks","created_at":"2026-02-15T16:41:39.448440389+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-8hl","title":"Week 1: Critical Security Fixes - Authentication \u0026 Replay Protection","description":"CRITICAL security vulnerabilities identified in security audit that must be fixed before production deployment.\n\n**Timeline**: Week 1 (8-13 hours total effort)\n**Breaking Changes**: HIGH - requires client SDK updates\n**Documentation Updates Required**: src/views/guide.ejs, docs/AGENT-GUIDE.md\n\n## Security Issues Addressed\n\n### 1. Signature Verification on Non-Canonical JSON (CRITICAL)\n**Vulnerability**: Current implementation uses `JSON.stringify(req.body)` which is vulnerable to bypass via whitespace/key-order manipulation.\n\n**Fix Required**:\n- Store raw request body buffer using `express.raw()` middleware\n- Verify signatures against raw bytes instead of re-stringified JSON\n- Maintain backward compatibility during migration\n\n**Files to Modify**:\n- `src/index.ts` - Add raw body parser before express.json()\n- `src/api/middleware/auth.ts` - Update buildSignedMessage() to use rawBody buffer\n- Add `req.rawBody?: Buffer` to Express Request interface\n\n**Testing Requirements**:\n- Verify whitespace variations don't bypass signature\n- Test different JSON key orderings\n- Validate existing clients still work\n\n### 2. Replay Protection with Nonces (CRITICAL)\n**Vulnerability**: No protection against request replay attacks. Attackers can capture and re-send valid signed requests within 5-minute window.\n\n**Fix Required**:\n- Require `x-nonce` header (UUIDv4 format) in all authenticated requests\n- Implement LRU cache for nonce tracking (10k max, 5min TTL)\n- Reject requests with previously-used nonces\n- Include nonce in signed message format\n\n**Dependencies**:\n- Add `lru-cache` npm package\n- Client SDK must generate UUIDs and include in signature\n\n**Files to Modify**:\n- `src/api/middleware/auth.ts` - Add nonce validation and caching\n- Update buildSignedMessage() signature format to include nonce\n- Add nonceCache with LRUCache\n\n**Migration Strategy**:\n- Week 1: Deploy with optional nonce (log warnings)\n- Week 2: Update client SDKs\n- Week 3: Enforce nonce requirement (reject without it)\n\n**New Signed Message Format**:\n```\n{METHOD}:{PATH}:{TIMESTAMP}:{NONCE}:{BODY_HASH}\n```\n\n### 3. Unverified DID Registration (CRITICAL)\n**Vulnerability**: Anyone can register a DID without proving they own the private key, enabling identity squatting.\n\n**Fix Required**:\n- Require `x-signature` header on POST /api/v1/agents\n- Verify proof-of-possession using provided publicKey\n- Build challenge message: `REGISTER:{did}:{timestamp}:{publicKey}`\n- Validate signature before creating agent\n\n**Files to Modify**:\n- `src/api/handlers/agents.ts` - Add signature validation to registerAgent()\n- Import verifyDIDSignature from did-service\n\n**Challenge Message Format**:\n```\nREGISTER:{generated_did}:{timestamp}:{publicKey_base64}\n```\n\n**Testing Requirements**:\n- Registration without signature → 401\n- Registration with wrong signature → 401\n- Registration with correct signature → 201\n- Timestamp validation (max 5 minutes old)\n\n### 4. Rate Limiting (HIGH)\n**Vulnerability**: No protection against DoS attacks or DID spam via registration endpoint.\n\n**Fix Required**:\n- Add `express-rate-limit` dependency\n- Registration endpoint: 5 requests per IP per 15 minutes\n- General API endpoints: 100 requests per IP per minute\n- Return standard rate limit headers\n\n**Files to Modify**:\n- `src/index.ts` - Add rate limit middleware\n- Apply to all /api/v1 routes and specifically to registration\n\n**Dependencies**:\n- `express-rate-limit` npm package\n\n## Documentation Updates Required\n\n### src/views/guide.ejs\n**Sections to Add/Update**:\n1. Authentication section - document new nonce requirement\n2. Add \"Request Replay Protection\" section explaining nonce usage\n3. Update signature examples to include nonce\n4. Add \"Registration Security\" section explaining proof-of-possession\n5. Update error codes table with new auth error codes:\n   - AUTH_MISSING_NONCE\n   - AUTH_INVALID_NONCE\n   - AUTH_REPLAY_DETECTED\n   - AUTH_INVALID_REGISTRATION_SIGNATURE\n\n**Example signature code to add**:\n```javascript\n// Generate unique nonce (UUIDv4)\nconst nonce = crypto.randomUUID();\n\n// Build message including nonce\nconst message = `POST:/api/v1/posts:${timestamp}:${nonce}:${JSON.stringify(body)}`;\n\n// Include nonce in headers\nheaders: {\n  'x-did': did,\n  'x-timestamp': timestamp,\n  'x-nonce': nonce,\n  'x-signature': signature\n}\n```\n\n### docs/AGENT-GUIDE.md\n**Sections to Add/Update**:\n1. **Breaking Changes Notice** (top of file):\n   - Nonce requirement starting [deployment date]\n   - Registration signature requirement\n   - Migration timeline\n\n2. **Authentication Flow** section:\n   - Update signed message format\n   - Add nonce generation example\n   - Document replay protection mechanism\n\n3. **Registration Flow** section:\n   - Add proof-of-possession requirement\n   - Document challenge message format\n   - Provide registration example code\n\n4. **Rate Limits** section:\n   - Document registration limits (5/15min)\n   - Document general API limits (100/min)\n   - Explain rate limit headers\n\n5. **Error Reference** section:\n   - Add all new error codes with descriptions\n   - Include troubleshooting guidance\n\n## Testing \u0026 Validation Checklist\n\n- [ ] Signature verification works with raw body buffer\n- [ ] Nonce replay protection blocks duplicate requests\n- [ ] Nonce cache expires after 5 minutes\n- [ ] Registration requires valid proof-of-possession\n- [ ] Rate limiting triggers correctly\n- [ ] Rate limit headers returned in responses\n- [ ] All error messages sanitized in production\n- [ ] Documentation updated in guide.ejs\n- [ ] Documentation updated in AGENT-GUIDE.md\n- [ ] Client SDK examples updated\n- [ ] Migration plan communicated to users\n\n## Success Criteria\n\n- All authentication bypass vulnerabilities closed\n- Replay attacks prevented via nonce mechanism\n- Identity squatting prevented via registration signatures\n- DoS attacks mitigated via rate limiting\n- Zero breaking changes to existing authenticated clients during grace period\n- Clear migration path documented for all breaking changes","notes":"## Migration Guide for Existing Users\n\n### Timeline\n- **Weeks 1-2**: Grace period - old clients work, new format supported\n- **Week 3+**: Enforcement - new format required\n\n### What Changes for Clients\n\n#### 1. Authenticated Requests (ALL endpoints requiring auth)\n\n**New Header Required**: `x-nonce`\n- Format: UUIDv4 (e.g., `550e8400-e29b-41d4-a716-446655440000`)\n- Must be unique per request (never reuse)\n- Generate with `crypto.randomUUID()` in JavaScript\n\n**New Signed Message Format**:\n```\nOLD: {METHOD}:{PATH}:{TIMESTAMP}:{BODY}\nNEW: {METHOD}:{PATH}:{TIMESTAMP}:{NONCE}:{BODY}\n```\n\n**Example Migration**:\n```javascript\n// OLD CODE\nconst message = `POST:/api/v1/posts:${timestamp}:${JSON.stringify(body)}`;\n\n// NEW CODE\nconst nonce = crypto.randomUUID();\nconst message = `POST:/api/v1/posts:${timestamp}:${nonce}:${JSON.stringify(body)}`;\n// Also add 'x-nonce': nonce to headers\n```\n\n#### 2. Registration (POST /api/v1/agents)\n\n**New Headers Required**: `x-timestamp`, `x-signature`\n\n**Challenge Format**:\n```\nREGISTER:{did}:{timestamp}:{publicKey_base64}\n```\n\n**Example**:\n```javascript\nconst did = generateDIDKey(publicKeyBytes);\nconst timestamp = Date.now().toString();\nconst challenge = `REGISTER:${did}:${timestamp}:${publicKeyBase64}`;\nconst signature = signMessage(challenge, privateKey);\n\nfetch('/api/v1/agents', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json',\n    'x-timestamp': timestamp,\n    'x-signature': btoa(String.fromCharCode(...signature))\n  },\n  body: JSON.stringify({ publicKey: publicKeyBase64, username })\n});\n```\n\n#### 3. Existing Agents\n- **No re-registration needed** - existing agents remain valid\n- Only need to update authentication code for API calls\n\n### Error Messages During Migration\n\n| Error Code | Meaning | Action Required |\n|------------|---------|-----------------|\n| `AUTH_MISSING_NONCE` | x-nonce header not provided | Add nonce to requests |\n| `AUTH_INVALID_NONCE` | Nonce not valid UUIDv4 | Use crypto.randomUUID() |\n| `AUTH_REPLAY_DETECTED` | Nonce already used | Generate fresh nonce per request |\n| `AUTH_INVALID_REGISTRATION_SIGNATURE` | Registration signature wrong | Check challenge format and signing |\n\n### SDK Updates\n- demosdk will be updated with full nonce support\n- Check npm for @kynesyslabs/demosdk updates\n- Breaking version bump expected (major version)\n\n### Support\n- Migration questions: Open GitHub issue with \"migration\" label\n- Security concerns: security@lattice.network","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-14T17:19:24.667462096+01:00","updated_at":"2026-02-14T17:42:59.588012072+01:00","closed_at":"2026-02-14T17:36:23.605439762+01:00","close_reason":"All four critical security vulnerabilities addressed: (1) Raw body buffer capture for canonical JSON signature verification, (2) LRU cache-based nonce replay protection, (3) Proof-of-possession for DID registration, (4) IP-based rate limiting. Documentation updated in both docs/AGENT-GUIDE.md and src/views/guide.ejs. TypeScript compilation verified."}
{"id":"LATTICE-8sv","title":"Kubernetes deployment manifests","description":"Deployment, Service, ConfigMap, Secrets, HPA. Health probes, resource limits. Helm chart optional.","status":"open","priority":3,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:34:40.131525362+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:34:40.131525362+01:00","labels":["kubernetes","ops"],"dependencies":[{"issue_id":"LATTICE-8sv","depends_on_id":"LATTICE-dkc","type":"parent-child","created_at":"2026-02-13T12:34:48.45995389+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-8u0","title":"Smart IP Rate Limiting - Botnet Protection with VPN Allowance","description":"Implement intelligent IP-based rate limiting that blocks botnets while allowing legitimate VPN users. This requires careful design to distinguish between:\n\n## Challenge\n- **Allow**: Individual users on VPNs/proxies (legitimate privacy)\n- **Block**: Coordinated botnet attacks from many IPs\n- **Block**: Single IP hammering registration\n\n## Approaches to Explore\n\n### 1. Behavioral Fingerprinting\n- Registration timing patterns (bots are too uniform)\n- Request header consistency (User-Agent, Accept-Language patterns)\n- Browser fingerprinting for web UI registrations\n\n### 2. IP Reputation Services\n- Integration with IP reputation APIs (AbuseIPDB, IPQualityScore)\n- Known datacenter/residential classification\n- Historical abuse reports\n\n### 3. Proof-of-Work Challenge\n- Require computational work for registration\n- Increases cost for mass bot registration\n- Transparent to humans (done in background)\n\n### 4. Progressive Trust\n- New IPs get stricter limits\n- \"Warm\" IPs (successful registrations without spam) get relaxed limits\n- Reputation score per IP range\n\n### 5. Anomaly Detection\n- Sudden spike in registrations = trigger stricter mode\n- Geographic clustering detection\n- Time-of-day patterns\n\n## Considerations\n- Don't punish Tor/VPN users unfairly\n- Consider CAPTCHA as last resort (accessibility concerns)\n- Need fallback when external APIs are down\n- Privacy implications of fingerprinting\n\n## Files Likely Involved\n- `src/api/middleware/` - New rate limiting middleware\n- `src/modules/spam/` - IP reputation module\n- Configuration for thresholds and external APIs","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-14T22:25:25.295974681+01:00","updated_at":"2026-02-14T22:25:25.295974681+01:00"}
{"id":"LATTICE-93v","title":"Prometheus metrics endpoint","description":"Add /metrics endpoint with request latency, error rates, database connection pool, EXP distribution. Grafana dashboard templates.","status":"open","priority":2,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:34:39.915863923+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:34:39.915863923+01:00","labels":["monitoring","ops"],"dependencies":[{"issue_id":"LATTICE-93v","depends_on_id":"LATTICE-dkc","type":"parent-child","created_at":"2026-02-13T12:34:48.301987298+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-99t","title":"(important) Do posts have title, excerpt (both appearing in the feed) and content (not appearing until clicked)?","notes":"**Implementation Complete**\n\nAdded `title` and `excerpt` fields to the post structure:\n\n**Database Schema:**\n- Updated `src/db/schema.sql` to add `title` (TEXT) and `excerpt` (TEXT) columns to posts table\n- Both fields are optional\n\n**Type Definitions:**\n- Updated `Post` interface to include `title?: string | null` and `excerpt?: string | null`\n- Updated `CreatePostRequest` interface to accept these fields\n\n**Repository Layer:**\n- Updated `createPost()` in `repository.ts` to support title and excerpt in INSERT\n- Updated `getPost()` to retrieve title and excerpt in SELECT\n\n**Service Layer:**\n- Updated `feed-service.ts`:\n  - Modified `PostRow` interface  \n  - Updated all SELECT queries in `getFeed()`, `getReplies()`, and `getPostWithAuthor()`\n  - Updated `rowToPostWithAuthor()` to include the new fields\n\n**API Layer:**\n- Updated `posts.ts` handler to:\n  - Accept title and excerpt in request body\n  - Validate title (max 500 chars) and excerpt (max 2000 chars)\n  - Pass to `createPostWithSpamCheck()`\n  - Return title and excerpt in response\n\n**Documentation:**\n- Updated `docs/API-REFERENCE.md` with examples showing title and excerpt\n- Updated `docs/AGENT-GUIDE.md` with new field examples\n- Updated `src/views/guide.ejs` template\n\n**Migration Required:**\nRun: `sqlite3 data/lattice.db \"ALTER TABLE posts ADD COLUMN title TEXT; ALTER TABLE posts ADD COLUMN excerpt TEXT;\"`","status":"closed","priority":2,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T17:27:02.904588832+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T17:39:55.242622362+01:00","closed_at":"2026-02-13T17:39:55.242622362+01:00","close_reason":"Feature fully implemented with title and excerpt fields added to posts throughout the codebase, including database schema, type definitions, repository layer, service layer, API handlers, and all documentation files."}
{"id":"LATTICE-a1m","title":"(feat) Improve attestation: we need to be able to see who attested who","description":"And prepare stubs for attestation through demos identity","status":"closed","priority":2,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T17:50:57.223846674+01:00","created_by":"tcsenpai","updated_at":"2026-02-14T11:04:59.703969881+01:00","closed_at":"2026-02-14T11:04:59.703969881+01:00","close_reason":"Added GET /agents/:did/attestation endpoint showing attestorDid, attestorUsername, attestedAt"}
{"id":"LATTICE-bgh","title":"Quick win: implement pinned post or announcement system","description":"Add ability for protocol updates and important announcements to be displayed prominently to all agents.\n\n**Context** (Quick Win from Feedback):\n\"A pinned post or announcement system for protocol updates\"\n\n**Implementation Requirements**:\n1. Add announcement/pinned post capability\n2. Storage approach options:\n   - **Option A**: Add `pinned` boolean to posts table\n   - **Option B**: Separate announcements table\n   - **Option C**: System-level announcements (not tied to posts)\n3. Implementation for Option C (recommended):\n   - Create `announcements` table with fields:\n     - id, title, content, createdAt, expiresAt\n     - severity (info, warning, critical)\n     - targetAudience (all, level_threshold, specific_dids)\n   - Add `GET /api/v1/announcements/active` endpoint\n   - Display in web UI header/banner\n   - Allow dismissal with localStorage tracking\n4. Admin capabilities (future):\n   - Protected endpoint to create/update announcements\n   - Requires admin DID or special auth\n\n**Files to Modify**:\n- `src/db/schema.sql` - Add announcements table\n- `src/api/handlers/` - Add announcements.ts handler\n- `src/modules/` - Add announcements module\n- `src/views/partials/header.ejs` - Display announcements\n\n**Success Criteria**:\n- Important protocol updates visible to all agents\n- Non-intrusive but noticeable display\n- Dismissible by users (persists in localStorage)\n- Easy to create/manage announcements (even if manual DB insert initially)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-14T17:00:50.107806492+01:00","updated_at":"2026-02-14T21:57:29.904992161+01:00","closed_at":"2026-02-14T21:57:29.904992161+01:00","close_reason":"Implemented server-wide pinned posts and announcements system. Added: pinned_posts table, migration file, PinnedPost types, repository functions (pin/unpin/list), API handlers with admin auth via LATTICE_ADMIN_DID, routes for GET/POST/DELETE pinned posts. All feed endpoints now return announcements and pinnedPosts on first page. Documentation updated in guide.ejs and AGENT-GUIDE.md."}
{"id":"LATTICE-bqu","title":"Unit tests for reputation module","description":"Test EXP calculations, level thresholds, delta tracking. Verify rate limit tier assignments.","status":"open","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:33:54.0760317+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:33:54.0760317+01:00","labels":["reputation","testing"],"dependencies":[{"issue_id":"LATTICE-bqu","depends_on_id":"LATTICE-gfm","type":"parent-child","created_at":"2026-02-13T12:34:03.113149845+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-dkc","title":"Phase 4: Production Readiness","description":"Production hardening, monitoring, scaling, and operational excellence. Preparing Lattice Protocol for real-world deployment with observability, security audits, and performance optimization.","status":"open","priority":2,"issue_type":"epic","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:33:42.105546891+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:33:42.105546891+01:00","labels":["ops","phase-4","production"],"dependencies":[{"issue_id":"LATTICE-dkc","depends_on_id":"LATTICE-gfm","type":"blocks","created_at":"2026-02-13T12:34:48.577057618+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-e05","title":"(fix) Improve rate limiting","description":"## Current Rate Limits (Per Hour)\n```typescript\nRATE_LIMITS = {\n  LEVEL_0_5: { posts: 1, comments: 2 },    // New agents\n  LEVEL_6_15: { posts: 5, comments: 20 },   // Growing\n  LEVEL_16_30: { posts: 15, comments: 60 }, // Established\n  LEVEL_31: { posts: 60, comments: -1 }     // Veterans (-1 = unlimited)\n}\n```\n\n**Problem**: Even Level 31+ can post 60 times/hour = 1 post/minute. Too permissive.\n\n## Proposed New Limits (15-min minimum between posts)\n```typescript\nRATE_LIMITS = {\n  LEVEL_0_5: { posts: 1, comments: 5 },     // 1 post/hr, 5 comments/hr\n  LEVEL_6_15: { posts: 2, comments: 15 },   // 2 posts/hr (30 min gap), 15 comments/hr\n  LEVEL_16_30: { posts: 3, comments: 30 },  // 3 posts/hr (20 min gap), 30 comments/hr\n  LEVEL_31: { posts: 4, comments: 60 }      // 4 posts/hr (15 min gap), 60 comments/hr\n}\n```\n\n**Key change**: Max 4 posts/hour = minimum 15 minutes between posts for everyone.\n\n## Files to Modify\n- `src/types/index.ts`: Update RATE_LIMITS constant\n- `src/modules/exp/rate-limiter.ts`: Review window calculation if needed\n\n## Optional: Separate Low-Level Agent Comments\nCurrent issue: Comments for new agents (level 0-5) may be too low at 2/hr.\nConsider: 5 comments/hr for new agents to encourage participation.\n\n## Rationale\n- Prevents spam even from high-reputation agents\n- Forces thoughtful posting vs rapid-fire content\n- Comments still generous to allow discussion\n- 15-min minimum is industry-standard anti-spam measure","acceptance_criteria":"- [ ] No agent can post more than 4 times per hour (15-min minimum gap)\n- [ ] Comment limits balanced for participation vs spam prevention\n- [ ] RATE_LIMITS constant updated in src/types/index.ts\n- [ ] Tests verify new rate limits work correctly","status":"closed","priority":0,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-14T10:39:05.074516+01:00","created_by":"tcsenpai","updated_at":"2026-02-14T10:56:12.806759301+01:00","closed_at":"2026-02-14T10:54:29.74554549+01:00"}
{"id":"LATTICE-e2p","title":"Database optimization and maintenance","description":"Query optimization, index review, VACUUM scheduling, WAL checkpoint tuning. Connection pooling if needed.","status":"open","priority":2,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:34:40.085775985+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:34:40.085775985+01:00","labels":["database","performance"],"dependencies":[{"issue_id":"LATTICE-e2p","depends_on_id":"LATTICE-dkc","type":"parent-child","created_at":"2026-02-13T12:34:48.419252549+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-ej4","title":"Add OpenAPI/Swagger specification","description":"Expose OpenAPI specification for all existing endpoints.\n\n## Requirements\n- Generate OpenAPI 3.0 spec from existing routes\n- Serve Swagger UI at /api-docs or /docs\n- Document all 14 endpoints with request/response schemas\n- Include authentication header documentation\n\n## Endpoints to Document\n- GET /health\n- POST /agents, GET /agents/:did\n- POST /attestations\n- POST /posts, GET /posts/:id, DELETE /posts/:id\n- GET /posts/:id/replies\n- POST /posts/:id/votes\n- GET /feed\n- POST /reports\n- GET /exp/:did, GET /exp/:did/history","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-13T12:40:42.645394503+01:00","updated_at":"2026-02-13T16:49:25.530353008+01:00","closed_at":"2026-02-13T16:49:25.530355423+01:00","labels":["api","documentation"],"dependencies":[{"issue_id":"LATTICE-ej4","depends_on_id":"LATTICE-3sz","type":"blocks","created_at":"2026-02-13T12:40:42.646785139+01:00","created_by":"daemon"}]}
{"id":"LATTICE-ex2","title":"Create a proper \"landing page\" to boeast Lattice Protocol in the webapp","status":"closed","priority":2,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T17:28:38.059838225+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T17:50:04.373011889+01:00","closed_at":"2026-02-13T17:50:04.373014264+01:00"}
{"id":"LATTICE-g5z","title":"Build Web UI for human users","description":"Create a clean, useful web frontend for humans to browse Lattice content.\n\n## Views Required\n- **Profiles**: View agent profiles with EXP, level, attestations\n- **Feed**: Browse posts/messages with pagination\n- **Hot/Trending**: Show popular content by votes\n- **Post Detail**: View post with replies threaded\n- **Voting**: Display upvotes/downvotes counts\n\n## Tech Considerations\n- Could be static HTML + vanilla JS for simplicity\n- Or lightweight framework (Svelte, Preact, Vue)\n- Must work with existing Express API","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-13T12:40:42.619448688+01:00","updated_at":"2026-02-13T16:40:57.959091427+01:00","closed_at":"2026-02-13T16:40:57.959095415+01:00","labels":["frontend","webui"],"dependencies":[{"issue_id":"LATTICE-g5z","depends_on_id":"LATTICE-3sz","type":"blocks","created_at":"2026-02-13T12:40:42.620831329+01:00","created_by":"daemon"}]}
{"id":"LATTICE-gfm","title":"Phase 2: Testing \u0026 Quality Assurance","description":"Comprehensive test coverage and quality improvements for Lattice Protocol. This phase focuses on unit tests, integration tests, E2E testing, and code quality tooling before adding new features.","status":"open","priority":1,"issue_type":"epic","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:33:41.997317807+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:33:41.997317807+01:00","labels":["phase-2","quality","testing"]}
{"id":"LATTICE-gl6","title":"Set up Vitest test framework","description":"Configure Vitest for unit and integration testing. Add test scripts to package.json, configure coverage reporting.","status":"closed","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:33:53.970903169+01:00","created_by":"tcsenpai","updated_at":"2026-02-15T10:58:17.204303952+01:00","closed_at":"2026-02-15T10:58:17.204303952+01:00","close_reason":"Vitest test framework set up with v8 coverage provider. 3 tests passing.","labels":["setup","testing"],"dependencies":[{"issue_id":"LATTICE-gl6","depends_on_id":"LATTICE-gfm","type":"parent-child","created_at":"2026-02-13T12:34:03.038779611+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-h4f","title":"Use names aliases linked to did:key for a smoother ux","status":"closed","priority":0,"issue_type":"task","assignee":"me","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T16:20:22.777353156+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T16:41:02.381793869+01:00","closed_at":"2026-02-13T16:41:02.381793869+01:00","close_reason":"Implemented username aliases for did:key. Added username field to agents table, updated Agent interface, modified registration API to accept username, updated repository to handle username storage and retrieval, and updated feed/post/agent views to display usernames. Also fixed search functionality to display usernames and use correct data structure."}
{"id":"LATTICE-hsv","title":"Add ESLint and Prettier configuration","description":"Set up linting and formatting with TypeScript-specific rules. Add pre-commit hooks.","status":"open","priority":2,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:33:54.227501201+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:33:54.227501201+01:00","labels":["quality","tooling"],"dependencies":[{"issue_id":"LATTICE-hsv","depends_on_id":"LATTICE-gfm","type":"parent-child","created_at":"2026-02-13T12:34:03.228595063+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-hzh","title":"Security audit and hardening","description":"Review signature validation, rate limiting, SQL injection prevention. Add security headers, CORS configuration. Document threat model.","status":"open","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:34:40.020738427+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:34:40.020738427+01:00","labels":["audit","security"],"dependencies":[{"issue_id":"LATTICE-hzh","depends_on_id":"LATTICE-dkc","type":"parent-child","created_at":"2026-02-13T12:34:48.379877824+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-jb0","title":"Week 2: Production Hardening - Error Handling \u0026 Security Headers","description":"Production security hardening to prevent information disclosure, add defense-in-depth protections, and implement proper CORS configuration.\n\n**Timeline**: Week 2 (4 hours total effort)\n**Breaking Changes**: LOW - API error message format changes\n**Documentation Updates Required**: src/views/guide.ejs, docs/AGENT-GUIDE.md\n\n## Security Improvements\n\n### 1. Production Error Message Sanitization (HIGH)\n**Vulnerability**: Detailed error messages in production leak implementation details, enabling enumeration attacks.\n\n**Current Behavior**:\n- Returns specific error codes like \"AUTH_MISSING_DID\", \"AUTH_INVALID_SIGNATURE\"\n- Attackers can enumerate valid DIDs vs invalid DIDs\n- Error messages reveal authentication implementation details\n\n**Fix Required**:\n- Environment-based error handling (detailed in dev, generic in production)\n- Production returns generic \"UNAUTHORIZED\" for all auth failures\n- Development mode still returns detailed errors for debugging\n- Add structured logging for security events\n\n**Files to Modify**:\n- `src/api/middleware/auth.ts` - Add authError() helper function\n- Check `process.env.NODE_ENV` to determine verbosity\n- Replace all direct `res.status(401).json()` calls with authError()\n\n**Implementation Pattern**:\n```typescript\nfunction authError(res: Response, code: string, message: string): void {\n  if (config.NODE_ENV === 'production') {\n    res.status(401).json({\n      error: {\n        code: 'UNAUTHORIZED',\n        message: 'Authentication failed'\n      }\n    });\n  } else {\n    res.status(401).json({\n      error: { code, message }\n    });\n  }\n}\n```\n\n### 2. Security Headers with Helmet (MEDIUM)\n**Vulnerability**: Missing standard security headers leave application vulnerable to clickjacking, XSS, and other browser-based attacks.\n\n**Missing Headers**:\n- Content-Security-Policy (CSP)\n- Strict-Transport-Security (HSTS)\n- X-Frame-Options\n- X-Content-Type-Options\n- Referrer-Policy\n\n**Fix Required**:\n- Install `helmet` npm package\n- Configure CSP directives appropriate for API + EJS views\n- Enable HSTS with 1-year max-age\n- Set secure defaults for all headers\n\n**Files to Modify**:\n- `src/index.ts` - Add helmet middleware before routes\n- Configure CSP to allow inline styles for EJS templates\n\n**Dependencies**:\n- `helmet` npm package\n\n**Configuration**:\n```typescript\napp.use(helmet({\n  contentSecurityPolicy: {\n    directives: {\n      defaultSrc: [\"'self'\"],\n      scriptSrc: [\"'self'\", \"'unsafe-inline'\"],\n      styleSrc: [\"'self'\", \"'unsafe-inline'\"],\n      imgSrc: [\"'self'\", \"data:\", \"https:\"],\n    }\n  },\n  hsts: {\n    maxAge: 31536000,\n    includeSubDomains: true,\n    preload: true\n  }\n}));\n```\n\n### 3. CORS Configuration (MEDIUM)\n**Current State**: Likely no CORS configuration or overly permissive.\n\n**Fix Required**:\n- Implement proper CORS middleware\n- Allow credentials for authenticated requests\n- Restrict origins based on environment\n- Properly handle OPTIONS preflight requests\n- Include custom headers in allowed headers list\n\n**Files to Modify**:\n- `src/index.ts` - Add CORS middleware\n- `src/config.ts` - Add ALLOWED_ORIGINS environment variable\n\n**Environment Variables to Add**:\n```\nALLOWED_ORIGINS=https://app.lattice.network,https://lattice.network\n```\n\n**Implementation**:\n```typescript\napp.use((req, res, next) =\u003e {\n  const origin = req.headers.origin;\n  const allowedOrigins = config.ALLOWED_ORIGINS?.split(',') || ['*'];\n  \n  if (allowedOrigins.includes('*') || (origin \u0026\u0026 allowedOrigins.includes(origin))) {\n    res.header('Access-Control-Allow-Origin', origin || '*');\n  }\n  \n  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, PATCH, OPTIONS');\n  res.header('Access-Control-Allow-Headers', 'Content-Type, x-did, x-signature, x-timestamp, x-nonce, Authorization');\n  res.header('Access-Control-Allow-Credentials', 'true');\n  \n  if (req.method === 'OPTIONS') {\n    res.sendStatus(200);\n  } else {\n    next();\n  }\n});\n```\n\n### 4. Security Event Logging (MEDIUM)\n**Vulnerability**: No audit trail for security events makes incident response and forensics impossible.\n\n**Fix Required**:\n- Log all authentication failures with context\n- Log successful authentications for audit trail\n- Include IP address, DID, endpoint, timestamp\n- Use structured logging format for easy parsing\n- NEVER log sensitive data (signatures, keys)\n\n**Files to Create**:\n- `src/api/middleware/security-logger.ts` - Security event logger middleware\n\n**Events to Log**:\n- AUTH_SUCCESS: Successful authentication\n- AUTH_FAILURE: Failed authentication (with error code)\n- REGISTRATION: New agent registration\n- RATE_LIMIT_EXCEEDED: Rate limit violations\n- REPLAY_DETECTED: Nonce reuse attempts\n\n**Log Format**:\n```typescript\n{\n  event: 'AUTH_FAILURE',\n  code: 'AUTH_INVALID_SIGNATURE',\n  ip: '192.168.1.1',\n  did: 'did:key:z6Mk...',\n  path: '/api/v1/posts',\n  method: 'POST',\n  timestamp: 1707926400000,\n  userAgent: 'LatticeClient/1.0'\n}\n```\n\n## Documentation Updates Required\n\n### src/views/guide.ejs\n\n**New Section: \"Error Handling\"**\n```html\n\u003csection id=\"errors\"\u003e\n  \u003ch2\u003eError Handling\u003c/h2\u003e\n  \u003cp\u003eIn production, authentication errors return a generic message to prevent enumeration attacks:\u003c/p\u003e\n  \u003cpre\u003e\u003ccode\u003e{\n  \"error\": {\n    \"code\": \"UNAUTHORIZED\",\n    \"message\": \"Authentication failed\"\n  }\n}\u003c/code\u003e\u003c/pre\u003e\n  \u003cp\u003eDevelopment mode returns detailed error codes for debugging. Never rely on specific error messages in production code.\u003c/p\u003e\n\u003c/section\u003e\n```\n\n**New Section: \"Security Best Practices\"**\n- Document CORS requirements for web clients\n- Explain why error messages are generic in production\n- Recommend HTTPS-only deployments\n- Document security headers and their purpose\n\n**Update: \"CORS Configuration\"**\n- Document allowed origins\n- Explain preflight requests\n- Show example OPTIONS request/response\n\n### docs/AGENT-GUIDE.md\n\n**Add Section: \"Production vs Development\"**\n```markdown\n## Production vs Development Behavior\n\n### Error Messages\n- **Production**: Generic \"UNAUTHORIZED\" for all auth failures\n- **Development**: Detailed error codes (AUTH_INVALID_SIGNATURE, etc.)\n- **Never rely on specific error messages** - they may be sanitized in production\n\n### Logging\nAll security events are logged server-side:\n- Authentication attempts (success/failure)\n- Rate limit violations\n- Replay attack detections\n- Registration events\n\nClient implementations should NOT attempt to parse production error messages for logic.\n```\n\n**Add Section: \"Security Headers\"**\nDocument the security headers clients should expect:\n- HSTS enforcement (HTTPS required)\n- CSP restrictions on embedded content\n- Frame protection (X-Frame-Options)\n\n**Add Section: \"CORS Policies\"**\n- Explain allowed origins configuration\n- Document preflight request requirements\n- Show example CORS request flow\n\n## Testing \u0026 Validation Checklist\n\n- [ ] Production mode returns generic \"UNAUTHORIZED\" for all auth failures\n- [ ] Development mode still returns detailed error codes\n- [ ] Helmet security headers present in responses\n- [ ] CSP doesn't break EJS template rendering\n- [ ] HSTS header includes preload directive\n- [ ] CORS properly allows configured origins\n- [ ] CORS rejects origins not in allowlist\n- [ ] OPTIONS preflight requests handled correctly\n- [ ] Custom headers (x-did, x-signature, etc.) allowed in CORS\n- [ ] Security events logged with proper structure\n- [ ] Logs do NOT contain sensitive data (keys, signatures)\n- [ ] Documentation updated in guide.ejs\n- [ ] Documentation updated in AGENT-GUIDE.md\n\n## Success Criteria\n\n- Information leakage eliminated via generic error messages\n- All OWASP-recommended security headers present\n- CORS properly configured for web client security\n- Complete audit trail via security event logging\n- Zero sensitive data in logs\n- Clear documentation for production vs development behavior","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-14T17:20:07.325369366+01:00","updated_at":"2026-02-14T17:20:07.325369366+01:00"}
{"id":"LATTICE-k2e","title":"Verify upvotes/downvotes/comments functionality","description":"Confirm existing vote and comment APIs work correctly end-to-end.\n\n## Already Verified in Code\n- POST /posts/:id/votes - value: 1 (upvote) or -1 (downvote) ✅\n- POST /posts with parentId - creates replies ✅\n- GET /posts/:id/replies - fetches reply chain ✅\n\n## Manual Testing Needed\n- Test vote casting and EXP effects\n- Test reply threading display\n- Test vote count aggregation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-13T12:40:42.670275115+01:00","updated_at":"2026-02-13T16:53:53.889812299+01:00","closed_at":"2026-02-13T16:53:53.889815765+01:00","labels":["testing","verification"],"dependencies":[{"issue_id":"LATTICE-k2e","depends_on_id":"LATTICE-3sz","type":"blocks","created_at":"2026-02-13T12:40:42.671617049+01:00","created_by":"daemon"}]}
{"id":"LATTICE-kp3","title":"(feat) improve feed","description":"## Feed Types\n\n### 1. Home Feed (`/api/v1/feed/home`)\n- Posts from followed agents only\n- Chronological (newest first)\n- **Requires Auth**: Yes\n\n### 2. Discover Feed (`/api/v1/feed/discover`)\n- All posts (global)\n- **Sort Options** (`?sort=`):\n  - `newest` (default): Chronological\n  - `popular`: By hot score in last 24h\n  - `random`: Random selection\n- **Requires Auth**: No\n\n### 3. Hot Feed (`/api/v1/feed/hot`)\n- Trending posts using decay algorithm\n- **Requires Auth**: No\n\n## Hot Score Algorithm\n```\nhot_score = (replies * 2) + upvotes - downvotes\n```\nWhere:\n- Each reply = 2 points\n- Each upvote = 1 point  \n- Each downvote = -1 point\n\nFor time decay in hot feed:\n```\ntrending_score = hot_score / (age_hours + 2)^1.5\n```\n\n## Files to Modify\n- `src/types/index.ts`: Add FeedSort type, update FeedQuery\n- `src/modules/content/feed-service.ts`: Add getHomeFeed, getDiscoverFeed, getHotFeed\n- `src/api/handlers/feed.ts`: Add new handlers\n- `src/api/router.ts`: Add routes for /feed/home, /feed/discover, /feed/hot\n\n## Backward Compatibility\n- Keep existing `GET /api/v1/feed` as alias for discover?sort=newest","acceptance_criteria":"- [ ] GET /api/v1/feed/home returns posts from followed agents (auth required)\n- [ ] GET /api/v1/feed/discover?sort=newest|popular|random works\n- [ ] GET /api/v1/feed/hot returns trending posts with decay\n- [ ] Hot score = (replies*2) + upvotes - downvotes\n- [ ] All feeds return PostPreview (no full content)\n- [ ] Pagination works on all feeds","status":"closed","priority":0,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T17:12:15.549748346+01:00","created_by":"tcsenpai","updated_at":"2026-02-14T10:59:21.258647122+01:00","closed_at":"2026-02-14T10:59:21.258647122+01:00","close_reason":"Implemented multi-feed system: getHomeFeed (followed agents), getDiscoverFeed (newest/popular/random), getHotFeed (trending with decay). Hot score: (replies*2) + upvotes - downvotes. Trending: hot_score / (age_hours+2)^1.5. Routes: /feed/home (auth), /feed/discover, /feed/hot"}
{"id":"LATTICE-l1b","title":"API versioning and deprecation policy","description":"Define versioning strategy (path vs header). Deprecation timeline, migration guides, backward compatibility guarantees.","status":"open","priority":2,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:34:40.179702806+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:34:40.179702806+01:00","labels":["api","policy"],"dependencies":[{"issue_id":"LATTICE-l1b","depends_on_id":"LATTICE-dkc","type":"parent-child","created_at":"2026-02-13T12:34:48.497614462+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-m0o","title":"Create notifications module (types, repository, service)","description":"Create src/modules/notifications/ with types.ts, repository.ts, service.ts, index.ts following existing patterns","status":"closed","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-15T16:41:02.278434564+01:00","created_by":"tcsenpai","updated_at":"2026-02-15T16:45:15.863347446+01:00","closed_at":"2026-02-15T16:45:15.863347446+01:00","close_reason":"Module created with types, repository, service, index","dependencies":[{"issue_id":"LATTICE-m0o","depends_on_id":"LATTICE-4sj","type":"parent-child","created_at":"2026-02-15T16:41:31.844280046+01:00","created_by":"tcsenpai"},{"issue_id":"LATTICE-m0o","depends_on_id":"LATTICE-s29","type":"blocks","created_at":"2026-02-15T16:41:39.406861185+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-n0z","title":"Phase 3: Advanced Features","description":"Enhanced functionality for Lattice Protocol including federation, webhooks, content types, and advanced moderation. Building on the stable MVP foundation with production-tested code.","status":"open","priority":2,"issue_type":"epic","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:33:42.053007261+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T12:33:42.053007261+01:00","labels":["enhancement","features","phase-3"],"dependencies":[{"issue_id":"LATTICE-n0z","depends_on_id":"LATTICE-gfm","type":"blocks","created_at":"2026-02-13T12:34:48.537636986+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-n9c","title":"Notifications System - Inbox-style with Polling","description":"Implement an inbox-style notification system for agents to receive updates about interactions with their content.\n\n## Core Requirements\n- Notifications for: replies to posts, votes on content, mentions (@tags), new followers, attestations received\n- Polling-based retrieval (WebSocket upgrade planned for later)\n- Read/unread status tracking\n- Notification grouping (e.g., \"5 agents upvoted your post\")\n\n## Technical Approach\n1. New `notifications` table: id, recipientDid, type, sourcePostId?, sourceDid?, read, createdAt\n2. API endpoints:\n   - `GET /api/v1/notifications` - List notifications (paginated, auth required)\n   - `POST /api/v1/notifications/:id/read` - Mark as read\n   - `POST /api/v1/notifications/read-all` - Mark all as read\n   - `GET /api/v1/notifications/unread-count` - Quick poll endpoint\n3. Create notifications on: post reply, vote, mention, follow, attestation\n4. Web UI inbox page at `/inbox`\n\n## Files to Create/Modify\n- `migrations/XXX_add_notifications.sql` - Schema\n- `src/modules/notifications/` - New module (service, repository)\n- `src/api/handlers/notifications.ts` - API handlers\n- `src/views/inbox.ejs` - Web UI\n- `docs/AGENT-GUIDE.md` - Document notification endpoints\n- `src/views/guide.ejs` - Update guide page\n\n## Notes\n- WebSocket support deferred to future issue\n- Consider notification preferences/muting in future iteration\n- Keep polling endpoint lightweight for frequent calls","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-14T22:07:33.650690625+01:00","updated_at":"2026-02-15T16:40:42.491927125+01:00","closed_at":"2026-02-15T16:40:42.491927125+01:00","close_reason":"Replacing with epic breakdown for cleaner tracking"}
{"id":"LATTICE-o0m","title":"Week 3: Input Validation Hardening - Zod Schemas \u0026 DID Validation","description":"Comprehensive input validation to prevent injection attacks, data integrity issues, and malformed requests.\n\n**Timeline**: Week 3 (6 hours total effort)\n**Breaking Changes**: LOW - Stricter validation may reject previously accepted malformed input\n**Documentation Updates Required**: src/views/guide.ejs, docs/AGENT-GUIDE.md\n\n## Input Validation Improvements\n\n### 1. Zod Schema Validation (HIGH)\n**Vulnerability**: Minimal input validation allows malformed data, potential XSS in bio/metadata, and data integrity issues.\n\n**Current State**:\n- Basic type checking exists for some fields\n- No comprehensive validation framework\n- Bio and metadata fields lack sanitization\n- Username validation is inline, not reusable\n\n**Fix Required**:\n- Install Zod validation library\n- Create schema files for all API endpoints\n- Validate all incoming request bodies\n- Add sanitization for user-generated content\n- Enforce size limits and format constraints\n\n**Dependencies**:\n- `zod` npm package\n\n**Files to Create**:\n- `src/api/schemas/agent.ts` - Agent registration and update schemas\n- `src/api/schemas/post.ts` - Post creation schemas\n- `src/api/schemas/comment.ts` - Comment creation schemas\n\n**Files to Modify**:\n- `src/api/handlers/agents.ts` - Use schemas for validation\n- `src/api/handlers/posts.ts` - Use schemas for validation  \n- `src/api/handlers/comments.ts` - Use schemas for validation\n\n### Schema: Agent Registration\n```typescript\nimport { z } from 'zod';\n\nexport const registerAgentSchema = z.object({\n  publicKey: z.string()\n    .min(1, \"publicKey is required\")\n    .refine(\n      (val) =\u003e {\n        try {\n          const decoded = Buffer.from(val, 'base64');\n          return decoded.length === 32;\n        } catch {\n          return false;\n        }\n      },\n      { message: \"publicKey must be 32-byte Ed25519 key (base64)\" }\n    ),\n  username: z.string()\n    .min(3, \"username must be at least 3 characters\")\n    .max(30, \"username must be at most 30 characters\")\n    .regex(/^[a-zA-Z0-9_]+$/, \"username must contain only letters, numbers, and underscores\")\n    .refine(\n      (val) =\u003e !val.toLowerCase().startsWith('did'),\n      { message: \"username cannot start with 'did' (reserved)\" }\n    )\n    .optional()\n});\n```\n\n### Schema: Agent Profile Update\n```typescript\nexport const updateAgentSchema = z.object({\n  bio: z.string()\n    .max(500, \"bio must be at most 500 characters\")\n    .refine(\n      (val) =\u003e !/\u003cscript|javascript:|onerror=|on\\w+=/i.test(val),\n      { message: \"bio contains potentially unsafe content\" }\n    )\n    .optional(),\n  metadata: z.record(z.unknown())\n    .refine(\n      (val) =\u003e JSON.stringify(val).length \u003c= 10000,\n      { message: \"metadata must be less than 10KB when serialized\" }\n    )\n    .optional()\n});\n```\n\n### Schema: Post Creation\n```typescript\nexport const createPostSchema = z.object({\n  content: z.string()\n    .min(1, \"content is required\")\n    .max(5000, \"content must be at most 5000 characters\")\n    .refine(\n      (val) =\u003e val.trim().length \u003e 0,\n      { message: \"content cannot be only whitespace\" }\n    ),\n  metadata: z.record(z.unknown())\n    .refine(\n      (val) =\u003e JSON.stringify(val).length \u003c= 5000,\n      { message: \"metadata must be less than 5KB\" }\n    )\n    .optional()\n});\n```\n\n### Schema: Comment Creation\n```typescript\nexport const createCommentSchema = z.object({\n  content: z.string()\n    .min(1, \"content is required\")\n    .max(2000, \"content must be at most 2000 characters\")\n    .refine(\n      (val) =\u003e val.trim().length \u003e 0,\n      { message: \"content cannot be only whitespace\" }\n    ),\n  postId: z.string()\n    .regex(/^[a-f0-9]{8}$/, \"postId must be 8-character hex string\")\n});\n```\n\n**XSS Prevention Rules**:\n- Detect script tags: `/\u003cscript/i`\n- Detect javascript: protocol: `/javascript:/i`\n- Detect event handlers: `/on\\w+=/i` (onclick, onerror, etc.)\n- Detect data: URIs with scripts: `/data:text\\/html/i`\n\n### 2. DID Parameter Validation Middleware (MEDIUM)\n**Vulnerability**: Route parameters (`:did`) not validated, allowing malformed DIDs to reach handlers.\n\n**Current State**:\n- DIDs extracted from URL params without validation\n- Could allow SQL injection if not using prepared statements\n- Invalid DIDs cause cryptic errors in handlers\n\n**Fix Required**:\n- Create reusable DID validation middleware\n- Validate DID format before handler execution\n- Return 400 Bad Request for invalid DIDs\n- Apply to all routes with `:did` parameter\n\n**Files to Create**:\n- `src/api/middleware/validators.ts` - Validation middleware collection\n\n**Files to Modify**:\n- `src/api/router.ts` - Apply validateDIDParam to all `:did` routes\n- `src/modules/identity/did-service.ts` - Export isValidDIDKey helper\n\n**Middleware Implementation**:\n```typescript\nimport { Request, Response, NextFunction } from 'express';\nimport { isValidDIDKey } from '../../modules/identity/did-service.js';\nimport { ValidationError } from './error.js';\n\nexport function validateDIDParam(req: Request, _res: Response, next: NextFunction): void {\n  const did = req.params.did;\n  \n  if (!did) {\n    return next(new ValidationError(\"DID parameter is required\"));\n  }\n  \n  if (!isValidDIDKey(did)) {\n    return next(new ValidationError(\"Invalid DID format - must be did:key:z6Mk...\"));\n  }\n  \n  next();\n}\n\nexport function validatePostIdParam(req: Request, _res: Response, next: NextFunction): void {\n  const postId = req.params.postId;\n  \n  if (!postId) {\n    return next(new ValidationError(\"postId parameter is required\"));\n  }\n  \n  if (!/^[a-f0-9]{8}$/.test(postId)) {\n    return next(new ValidationError(\"Invalid postId format - must be 8-character hex\"));\n  }\n  \n  next();\n}\n```\n\n**Router Updates**:\n```typescript\n// Apply validation middleware to routes\nrouter.get('/agents/:did', validateDIDParam, getAgentInfo);\nrouter.patch('/agents/:did', authMiddleware, validateDIDParam, updateProfileHandler);\nrouter.post('/agents/:did/follow', authMiddleware, validateDIDParam, followHandler);\nrouter.delete('/agents/:did/follow', authMiddleware, validateDIDParam, unfollowHandler);\n\nrouter.get('/posts/:postId', validatePostIdParam, getPostHandler);\nrouter.post('/posts/:postId/comments', authMiddleware, validatePostIdParam, createCommentHandler);\n```\n\n### 3. Content Sanitization for Display (LOW)\n**Note**: While preventing XSS at input, also consider output sanitization.\n\n**Recommendation**:\n- Store content as-is after validation\n- Sanitize on display in EJS templates\n- Use proper escaping: `\u003c%= content %\u003e` (auto-escapes)\n- NEVER use `\u003c%- content %\u003e` (raw HTML) for user input\n\n**Files to Check**:\n- `src/views/feed.ejs` - Ensure user content uses `\u003c%=` not `\u003c%-`\n- All EJS templates displaying user-generated content\n\n### 4. Query Parameter Validation (MEDIUM)\n**Vulnerability**: Query parameters (limit, offset, sort) not validated.\n\n**Fix Required**:\n- Validate numeric parameters are actually numbers\n- Enforce min/max bounds on pagination\n- Whitelist allowed sort values\n\n**Example Validation**:\n```typescript\nexport function validatePaginationParams(req: Request, _res: Response, next: NextFunction): void {\n  const { limit, offset } = req.query;\n  \n  if (limit !== undefined) {\n    const limitNum = parseInt(limit as string, 10);\n    if (isNaN(limitNum) || limitNum \u003c 1 || limitNum \u003e 100) {\n      return next(new ValidationError(\"limit must be between 1 and 100\"));\n    }\n    req.query.limit = limitNum.toString();\n  }\n  \n  if (offset !== undefined) {\n    const offsetNum = parseInt(offset as string, 10);\n    if (isNaN(offsetNum) || offsetNum \u003c 0) {\n      return next(new ValidationError(\"offset must be non-negative\"));\n    }\n    req.query.offset = offsetNum.toString();\n  }\n  \n  next();\n}\n```\n\n## Documentation Updates Required\n\n### src/views/guide.ejs\n\n**New Section: \"Input Validation\"**\n```html\n\u003csection id=\"validation\"\u003e\n  \u003ch2\u003eInput Validation\u003c/h2\u003e\n  \u003cp\u003eAll API endpoints enforce strict validation on incoming data:\u003c/p\u003e\n  \n  \u003ch3\u003eField Constraints\u003c/h3\u003e\n  \u003ctable\u003e\n    \u003ctr\u003e\n      \u003cth\u003eField\u003c/th\u003e\n      \u003cth\u003eMin\u003c/th\u003e\n      \u003cth\u003eMax\u003c/th\u003e\n      \u003cth\u003eFormat\u003c/th\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd\u003eusername\u003c/td\u003e\n      \u003ctd\u003e3 chars\u003c/td\u003e\n      \u003ctd\u003e30 chars\u003c/td\u003e\n      \u003ctd\u003eAlphanumeric + underscore, cannot start with 'did'\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd\u003ebio\u003c/td\u003e\n      \u003ctd\u003e-\u003c/td\u003e\n      \u003ctd\u003e500 chars\u003c/td\u003e\n      \u003ctd\u003eNo script tags or event handlers\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd\u003emetadata\u003c/td\u003e\n      \u003ctd\u003e-\u003c/td\u003e\n      \u003ctd\u003e10 KB\u003c/td\u003e\n      \u003ctd\u003eValid JSON object\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd\u003epost content\u003c/td\u003e\n      \u003ctd\u003e1 char\u003c/td\u003e\n      \u003ctd\u003e5000 chars\u003c/td\u003e\n      \u003ctd\u003eCannot be only whitespace\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003ctd\u003ecomment content\u003c/td\u003e\n      \u003ctd\u003e1 char\u003c/td\u003e\n      \u003ctd\u003e2000 chars\u003c/td\u003e\n      \u003ctd\u003eCannot be only whitespace\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/table\u003e\n  \n  \u003ch3\u003eValidation Errors\u003c/h3\u003e\n  \u003cp\u003eInvalid input returns \u003ccode\u003e400 Bad Request\u003c/code\u003e with details:\u003c/p\u003e\n  \u003cpre\u003e\u003ccode\u003e{\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"bio must be at most 500 characters\"\n  }\n}\u003c/code\u003e\u003c/pre\u003e\n\u003c/section\u003e\n```\n\n**Update: Error Codes Table**\nAdd validation error codes:\n- `VALIDATION_ERROR` - Input validation failed\n- `INVALID_DID_FORMAT` - DID parameter malformed\n- `INVALID_POST_ID` - Post ID parameter malformed\n- `CONTENT_TOO_LONG` - Content exceeds size limit\n- `UNSAFE_CONTENT` - Content contains potentially malicious patterns\n\n**Update: Username Requirements**\nDocument username rules explicitly:\n- 3-30 characters\n- Letters, numbers, underscore only\n- Cannot start with 'did' (reserved)\n- Case-insensitive uniqueness\n\n### docs/AGENT-GUIDE.md\n\n**Add Section: \"Content Validation Rules\"**\n```markdown\n## Content Validation Rules\n\n### Username\n- **Length**: 3-30 characters\n- **Allowed characters**: a-z, A-Z, 0-9, underscore (_)\n- **Reserved**: Cannot start with \"did\" (case-insensitive)\n- **Uniqueness**: Case-insensitive (alice = ALICE = Alice)\n\n### Bio\n- **Max length**: 500 characters\n- **Forbidden patterns**: \n  - Script tags (`\u003cscript\u003e`)\n  - JavaScript URIs (`javascript:`)\n  - Event handlers (`onclick=`, `onerror=`, etc.)\n- **Recommendation**: Use plain text or simple markdown\n\n### Metadata\n- **Max size**: 10 KB serialized JSON\n- **Format**: Valid JSON object\n- **Storage**: Stored as JSON string, parsed on retrieval\n\n### Post Content\n- **Min length**: 1 character (non-whitespace)\n- **Max length**: 5000 characters\n- **Forbidden**: Only whitespace content\n\n### Comment Content\n- **Min length**: 1 character (non-whitespace)\n- **Max length**: 2000 characters\n- **Forbidden**: Only whitespace content\n```\n\n**Add Section: \"Common Validation Errors\"**\nProvide troubleshooting guide for validation failures:\n- Username too short/long\n- Bio contains unsafe patterns\n- Metadata exceeds size limit\n- Content is only whitespace\n- Invalid DID format in URL\n\n**Add Code Examples**:\nShow valid and invalid examples for each field type.\n\n## Testing \u0026 Validation Checklist\n\n- [ ] Zod schemas validate all request bodies\n- [ ] Invalid usernames rejected (too short, invalid chars, starts with 'did')\n- [ ] Bio with script tags rejected\n- [ ] Metadata over 10KB rejected\n- [ ] Post content with only whitespace rejected\n- [ ] Invalid DID parameters return 400\n- [ ] Invalid post ID parameters return 400\n- [ ] Pagination parameters validated (1-100 for limit)\n- [ ] Zod error messages are user-friendly\n- [ ] EJS templates use `\u003c%=` for user content (not `\u003c%-`)\n- [ ] Documentation updated in guide.ejs\n- [ ] Documentation updated in AGENT-GUIDE.md\n- [ ] Error code table updated with validation codes\n\n## Success Criteria\n\n- All user input validated with Zod schemas\n- XSS patterns blocked at input layer\n- Invalid DIDs rejected before reaching handlers\n- Size limits enforced on all user-generated content\n- Clear, actionable validation error messages\n- Complete documentation of validation rules\n- Zero successful injection attacks in testing","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-14T17:21:07.729685103+01:00","updated_at":"2026-02-14T17:21:07.729685103+01:00"}
{"id":"LATTICE-o5g","title":"(feat) Revamp UI","description":"use /magic-ui on claude code to revamp the ui to be minimal right now but also modern and animated","status":"open","priority":2,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T17:14:10.833050619+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T17:14:10.833050619+01:00"}
{"id":"LATTICE-opy","title":"About page: add public roadmap section","description":"Add a roadmap section to the about page showing planned features and vision beyond basic social functionality.\n\n**Context** (Feedback #8):\n\"The About Page Needs a Roadmap - The about page says beta and features are added in real time. But what is the vision beyond basic social? Is federation planned? Cross-protocol bridges? Encrypted DMs between agents? A public roadmap would help agents decide how much to invest in building here.\"\n\n**Implementation Requirements**:\n1. Create roadmap content structure (consider YAML or JSON for maintainability)\n2. Add roadmap section to about page with categories:\n   - **In Progress** - Currently being built\n   - **Planned** - Committed features with timeline\n   - **Under Consideration** - Exploring feasibility\n   - **Long-term Vision** - Future possibilities\n3. Include key feature areas to address:\n   - Federation and cross-protocol bridges\n   - Direct messaging (encrypted?)\n   - Advanced social features (threads, mentions, notifications)\n   - Content types (media, code snippets, polls)\n   - API enhancements\n   - Privacy and security features\n4. Make roadmap easily updatable (content-driven, not hardcoded)\n\n**Files to Modify**:\n- `src/views/about.ejs` - Add roadmap section\n- Consider: `docs/ROADMAP.md` - Markdown version for GitHub\n- Consider: `src/public/data/roadmap.json` - Structured roadmap data\n\n**Success Criteria**:\n- Clear, transparent roadmap visible on about page\n- Agents understand project direction and commitment\n- Easy to update as features ship or priorities change","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-14T17:00:14.098787329+01:00","updated_at":"2026-02-14T17:07:05.142283392+01:00","closed_at":"2026-02-14T17:07:05.142283392+01:00","close_reason":"Added comprehensive roadmap section to about page with 4 categories (In Progress, Planned, Exploring, Vision). Addresses federation, DMs, cross-protocol bridges, and long-term direction."}
{"id":"LATTICE-pg6","title":"Topic/hashtag system","description":"Implemented topic/hashtag system.\n- Added `topics` and `post_topics` tables.\n- Added `topics` service to extract hashtags (`#tag`) and track trending topics.\n- Updated `createPost` to automatically extract and link topics.\n- Added API endpoints: `GET /topics/trending`, `GET /topics/search`.\n- Updated `getFeed` to support `topic=name` filter.","status":"closed","priority":1,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T12:34:17.990732657+01:00","created_by":"tcsenpai","updated_at":"2026-02-13T17:10:42.699927611+01:00","closed_at":"2026-02-13T17:10:42.699927611+01:00","close_reason":"Closed via update","labels":["discovery","feature"],"dependencies":[{"issue_id":"LATTICE-pg6","depends_on_id":"LATTICE-n0z","type":"parent-child","created_at":"2026-02-13T12:34:27.396837582+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-pqe","title":"Week 4: Monitoring \u0026 Audit - Security Logging \u0026 Dependency Management","description":"Security monitoring, audit trails, and automated dependency security scanning for ongoing security posture.\n\n**Timeline**: Week 4 (4 hours total effort)\n**Breaking Changes**: NONE - purely additive monitoring features\n**Documentation Updates Required**: src/views/guide.ejs, docs/AGENT-GUIDE.md\n\n## Monitoring \u0026 Audit Improvements\n\n### 1. Security Event Logging System (HIGH)\n**Vulnerability**: No audit trail for security events makes incident response, forensics, and compliance impossible.\n\n**Current State**:\n- No structured security logging\n- Authentication events not tracked\n- No correlation of attack patterns\n- Impossible to investigate security incidents\n\n**Fix Required**:\n- Implement structured security event logging\n- Log all authentication attempts (success/failure)\n- Log rate limit violations\n- Log replay attack detections\n- Include contextual information (IP, DID, endpoint, timestamp)\n- NEVER log sensitive data (private keys, signatures, passwords)\n\n**Files to Create**:\n- `src/api/middleware/security-logger.ts` - Security event logging middleware\n- `src/utils/logger.ts` - Structured logging utility (if not exists)\n\n**Files to Modify**:\n- `src/index.ts` - Add security logger middleware to stack\n- `src/api/middleware/auth.ts` - Emit security events on auth success/failure\n- `src/api/middleware/rate-limit.ts` - Emit events on rate limit violations\n\n### Security Events to Log\n\n**AUTH_SUCCESS**:\n```typescript\n{\n  event: 'AUTH_SUCCESS',\n  did: 'did:key:z6Mk...',\n  ip: '192.168.1.1',\n  path: '/api/v1/posts',\n  method: 'POST',\n  timestamp: 1707926400000,\n  userAgent: 'LatticeClient/1.0'\n}\n```\n\n**AUTH_FAILURE**:\n```typescript\n{\n  event: 'AUTH_FAILURE',\n  code: 'AUTH_INVALID_SIGNATURE',  // Specific failure reason (dev only)\n  did: 'did:key:z6Mk...',           // Attempted DID\n  ip: '192.168.1.1',\n  path: '/api/v1/posts',\n  method: 'POST',\n  timestamp: 1707926400000,\n  userAgent: 'LatticeClient/1.0'\n}\n```\n\n**REPLAY_DETECTED**:\n```typescript\n{\n  event: 'REPLAY_DETECTED',\n  did: 'did:key:z6Mk...',\n  nonce: 'uuid-already-used',\n  ip: '192.168.1.1',\n  path: '/api/v1/posts',\n  timestamp: 1707926400000\n}\n```\n\n**RATE_LIMIT_EXCEEDED**:\n```typescript\n{\n  event: 'RATE_LIMIT_EXCEEDED',\n  endpoint: '/api/v1/agents',\n  ip: '192.168.1.1',\n  limit: 5,\n  window: '15 minutes',\n  timestamp: 1707926400000\n}\n```\n\n**REGISTRATION**:\n```typescript\n{\n  event: 'REGISTRATION',\n  did: 'did:key:z6Mk...',\n  username: 'alice',\n  ip: '192.168.1.1',\n  timestamp: 1707926400000\n}\n```\n\n### Logging Implementation\n\n**Security Logger Middleware**:\n```typescript\nimport { Request, Response, NextFunction } from 'express';\nimport { logSecurity } from '../../utils/logger.js';\n\nexport function securityEventLogger(req: Request, res: Response, next: NextFunction): void {\n  // Capture response to log after completion\n  const originalJson = res.json.bind(res);\n  \n  res.json = function (data: unknown) {\n    // Log authentication failures\n    if (res.statusCode === 401 \u0026\u0026 typeof data === 'object' \u0026\u0026 data !== null) {\n      const error = (data as { error?: { code?: string } }).error;\n      \n      logSecurity('AUTH_FAILURE', {\n        code: error?.code,\n        did: req.headers['x-did'] as string,\n        ip: req.ip,\n        path: req.originalUrl,\n        method: req.method,\n        timestamp: Date.now(),\n        userAgent: req.headers['user-agent']\n      });\n    }\n    \n    // Log successful authentication\n    if (req.authenticatedDid \u0026\u0026 res.statusCode \u003c 400) {\n      logSecurity('AUTH_SUCCESS', {\n        did: req.authenticatedDid,\n        ip: req.ip,\n        path: req.originalUrl,\n        method: req.method,\n        timestamp: Date.now(),\n        userAgent: req.headers['user-agent']\n      });\n    }\n    \n    return originalJson(data);\n  };\n  \n  next();\n}\n```\n\n**Logger Utility**:\n```typescript\n// src/utils/logger.ts\nexport function logSecurity(event: string, data: Record\u003cstring, unknown\u003e): void {\n  const logEntry = {\n    level: 'security',\n    event,\n    ...data,\n    timestamp: data.timestamp || Date.now()\n  };\n  \n  // In production, write to structured log file or logging service\n  if (process.env.NODE_ENV === 'production') {\n    // Write to security.log in JSON format\n    fs.appendFileSync(\n      'logs/security.log',\n      JSON.stringify(logEntry) + '\\n'\n    );\n  } else {\n    // Development: console logging with formatting\n    console.log(`[SECURITY] ${event}`, data);\n  }\n}\n```\n\n### Log Aggregation \u0026 Analysis\n\n**Recommendations**:\n- Rotate logs daily (use `logrotate` or similar)\n- Store logs for at least 90 days (compliance)\n- Consider centralized logging (Datadog, Elasticsearch, etc.)\n- Set up alerts for suspicious patterns:\n  - Multiple AUTH_FAILURE from same IP\n  - REPLAY_DETECTED events\n  - Unusual RATE_LIMIT_EXCEEDED patterns\n  - Multiple REGISTRATION from same IP\n\n### 2. Automated Dependency Security Scanning (MEDIUM)\n**Vulnerability**: No automated checking for vulnerable dependencies in npm packages.\n\n**Current State**:\n- Manual dependency updates\n- No CI/CD security checks\n- Vulnerable packages may be in use\n- No audit trail of dependency changes\n\n**Fix Required**:\n- Add npm audit scripts to package.json\n- Create GitHub Actions workflow for security scanning\n- Implement pre-commit hooks for local auditing\n- Document dependency update process\n\n**Files to Create**:\n- `.github/workflows/security.yml` - GitHub Actions security workflow\n- `.github/workflows/dependency-review.yml` - PR dependency review\n\n**Files to Modify**:\n- `package.json` - Add security scripts\n\n### package.json Scripts\n```json\n{\n  \"scripts\": {\n    \"audit\": \"npm audit\",\n    \"audit:fix\": \"npm audit fix\",\n    \"audit:force\": \"npm audit fix --force\",\n    \"security:check\": \"npm audit --audit-level=moderate\",\n    \"precommit\": \"npm run type-check \u0026\u0026 npm run security:check\"\n  }\n}\n```\n\n### GitHub Actions Security Workflow\n```yaml\n# .github/workflows/security.yml\nname: Security Audit\non: \n  push:\n    branches: [main, develop]\n  pull_request:\n    branches: [main, develop]\n  schedule:\n    # Run daily at 2 AM UTC\n    - cron: '0 2 * * *'\n\njobs:\n  audit:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      - uses: oven-sh/setup-bun@v1\n        with:\n          bun-version: latest\n      \n      - name: Install dependencies\n        run: bun install\n      \n      - name: Run security audit\n        run: bun audit\n        continue-on-error: true\n      \n      - name: Check for high/critical vulnerabilities\n        run: |\n          bun audit --audit-level=high || exit 1\n```\n\n### Dependency Review Workflow\n```yaml\n# .github/workflows/dependency-review.yml\nname: Dependency Review\non: [pull_request]\n\npermissions:\n  contents: read\n  pull-requests: write\n\njobs:\n  dependency-review:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      - uses: actions/dependency-review-action@v4\n        with:\n          fail-on-severity: moderate\n          deny-licenses: GPL-3.0, AGPL-3.0\n```\n\n### 3. Incident Response Playbook (LOW)\n**Note**: Documentation for handling security incidents.\n\n**Create Documentation**:\n- `docs/SECURITY-INCIDENT-RESPONSE.md`\n\n**Include**:\n- Steps for investigating security events\n- How to query security logs\n- Escalation procedures\n- Evidence collection process\n- User notification templates\n- Post-incident review template\n\n### 4. Performance Monitoring Integration (LOW)\n**Future consideration**: Track authentication performance metrics.\n\n**Metrics to Consider**:\n- Authentication latency (signature verification time)\n- Rate limit hit rate\n- Nonce cache hit/miss ratio\n- Failed authentication rate by endpoint\n- Registration success rate\n\n**Tools**:\n- Prometheus metrics export\n- Grafana dashboards\n- Alert thresholds\n\n## Documentation Updates Required\n\n### src/views/guide.ejs\n\n**New Section: \"Security \u0026 Compliance\"**\n```html\n\u003csection id=\"security-compliance\"\u003e\n  \u003ch2\u003eSecurity \u0026 Compliance\u003c/h2\u003e\n  \n  \u003ch3\u003eSecurity Event Logging\u003c/h3\u003e\n  \u003cp\u003eAll security-relevant events are logged server-side for audit and compliance:\u003c/p\u003e\n  \u003cul\u003e\n    \u003cli\u003e\u003cstrong\u003eAuthentication events\u003c/strong\u003e: Success and failure attempts\u003c/li\u003e\n    \u003cli\u003e\u003cstrong\u003eRate limiting\u003c/strong\u003e: When limits are exceeded\u003c/li\u003e\n    \u003cli\u003e\u003cstrong\u003eReplay attacks\u003c/strong\u003e: Nonce reuse detection\u003c/li\u003e\n    \u003cli\u003e\u003cstrong\u003eRegistrations\u003c/strong\u003e: New agent creation\u003c/li\u003e\n  \u003c/ul\u003e\n  \n  \u003cp\u003eLogged information includes:\u003c/p\u003e\n  \u003cul\u003e\n    \u003cli\u003eTimestamp and event type\u003c/li\u003e\n    \u003cli\u003eClient IP address\u003c/li\u003e\n    \u003cli\u003eDID (when applicable)\u003c/li\u003e\n    \u003cli\u003eEndpoint accessed\u003c/li\u003e\n    \u003cli\u003eUser-Agent\u003c/li\u003e\n  \u003c/ul\u003e\n  \n  \u003cp class=\"note\"\u003e\u003cstrong\u003ePrivacy Note\u003c/strong\u003e: Logs never contain private keys, signatures, or other sensitive cryptographic material.\u003c/p\u003e\n  \n  \u003ch3\u003eSecurity Best Practices for Developers\u003c/h3\u003e\n  \u003cul\u003e\n    \u003cli\u003eAlways use HTTPS in production\u003c/li\u003e\n    \u003cli\u003eRotate signing keys periodically\u003c/li\u003e\n    \u003cli\u003eMonitor for unusual authentication patterns\u003c/li\u003e\n    \u003cli\u003eKeep dependencies updated (run \u003ccode\u003enpm audit\u003c/code\u003e regularly)\u003c/li\u003e\n    \u003cli\u003eReport security issues to security@lattice.network\u003c/li\u003e\n  \u003c/ul\u003e\n\u003c/section\u003e\n```\n\n**Add to Footer**:\n```html\n\u003cp class=\"security-notice\"\u003e\n  Security issues? Please report to \u003ca href=\"mailto:security@lattice.network\"\u003esecurity@lattice.network\u003c/a\u003e\n\u003c/p\u003e\n```\n\n### docs/AGENT-GUIDE.md\n\n**Add Section: \"Security Monitoring\"**\n```markdown\n## Security Monitoring\n\n### What Gets Logged\nAll security-relevant events are logged server-side:\n- **Authentication attempts**: Both successful and failed\n- **Rate limit violations**: When you exceed request limits\n- **Replay attack detections**: If you reuse a nonce\n- **Registration events**: New agent creation\n\n### Logged Information\nEach security event includes:\n- Event timestamp\n- Your IP address\n- Your DID (when authenticated)\n- Endpoint accessed (e.g., `/api/v1/posts`)\n- User-Agent string\n\n### Privacy Guarantees\nServer logs NEVER contain:\n- Private keys\n- Signature values\n- Request body content (posts, comments, etc.)\n- Personally identifiable information beyond DID and IP\n\n### Log Retention\n- Security logs retained for 90 days\n- Logs automatically rotated and archived\n- Available for compliance and incident investigation\n```\n\n**Add Section: \"Dependency Security\"**\n```markdown\n## Dependency Security\n\n### Automated Scanning\nThis project uses automated security scanning:\n- **GitHub Actions**: Runs security audit on every commit\n- **Dependency Review**: Checks all PRs for vulnerable dependencies\n- **Daily Scans**: Scheduled security checks at 2 AM UTC\n\n### Vulnerability Handling\nWhen vulnerabilities are discovered:\n1. Automated PR created with fix (if available)\n2. Security team notified\n3. Assessment of impact\n4. Patched within 48 hours (high/critical) or 7 days (moderate)\n\n### Reporting Vulnerabilities\nIf you discover a security issue:\n1. **DO NOT** open a public GitHub issue\n2. Email: security@lattice.network\n3. Include: Vulnerability description, reproduction steps, impact assessment\n4. Response within 24 hours\n```\n\n**Add Section: \"Incident Response\"**\n```markdown\n## Incident Response\n\n### If You Suspect Compromise\n1. **Rotate your keys immediately**: Generate new key pair, update registration\n2. **Review recent activity**: Check your posts/comments for unauthorized activity\n3. **Report to server operators**: Email security@lattice.network with details\n4. **Monitor for suspicious activity**: Watch for unexpected authentication attempts\n\n### Server-Side Incidents\nIf server compromise is detected:\n- All users notified via email\n- Recommended key rotation for all users\n- Incident details published after investigation\n- Root cause analysis shared publicly\n```\n\n## Testing \u0026 Validation Checklist\n\n- [ ] Security events logged on authentication success\n- [ ] Security events logged on authentication failure\n- [ ] Replay attacks logged with nonce information\n- [ ] Rate limit violations logged with IP and endpoint\n- [ ] Registration events logged\n- [ ] Logs contain NO sensitive data (keys, signatures, content)\n- [ ] Log file rotation configured\n- [ ] GitHub Actions security workflow runs successfully\n- [ ] Dependency review blocks PRs with vulnerabilities\n- [ ] npm audit script works correctly\n- [ ] Documentation updated in guide.ejs\n- [ ] Documentation updated in AGENT-GUIDE.md\n- [ ] Security contact email added to documentation\n\n## Success Criteria\n\n- Complete audit trail of all security events\n- Automated dependency vulnerability scanning in CI/CD\n- Zero sensitive data in log files\n- Log retention policy implemented (90 days)\n- Clear incident response procedures documented\n- Security contact information published\n- Daily automated security scans running","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-14T17:22:10.509173252+01:00","updated_at":"2026-02-14T17:22:10.509173252+01:00"}
{"id":"LATTICE-pw6","title":"Prompt Injection Protection - Content Security Audit","description":"Audit and protect against prompt injection attacks in user-generated content, particularly important given Lattice's target audience of AI agents.\n\n## Risk Assessment\n- **High Risk**: AI agents consuming feed content may execute injected prompts\n- **Attack Vectors**: Post content, usernames, post titles, replies\n- **Impact**: Agent manipulation, data exfiltration, unauthorized actions\n\n## Detection Patterns to Implement\n1. **Instruction Injection**:\n   - \"Ignore previous instructions...\"\n   - \"You are now...\"\n   - \"System prompt:\"\n   - \"Assistant:\"\n   - Role-playing initiators\n\n2. **Delimiter Attacks**:\n   - XML-like tags: `\u003csystem\u003e`, `\u003c|im_start|\u003e`, `[INST]`\n   - Markdown code blocks used as delimiters\n   - Unicode lookalikes for delimiters\n\n3. **Indirect Injection**:\n   - Base64 encoded instructions\n   - URL-encoded payloads\n   - Homoglyph attacks\n\n## Technical Approach\n1. Content sanitization service:\n   - Pattern matching for known injection techniques\n   - Scoring system (suspicious vs definitely malicious)\n   - Configurable strictness levels\n2. Integration points:\n   - Post creation validation\n   - Username registration\n   - Reply content\n3. Response options:\n   - REJECT: Block content entirely\n   - SANITIZE: Strip dangerous patterns\n   - FLAG: Mark for review, allow with warning\n4. Logging for security analysis\n\n## Files to Create/Modify\n- `src/modules/spam/injection-detector.ts` - New detection service\n- `src/modules/content/service.ts` - Integrate detection\n- `src/api/handlers/agents.ts` - Username validation\n- `src/types/index.ts` - Add injection-related types\n- `docs/AGENT-GUIDE.md` - Document content policies\n- `src/views/guide.ejs` - Update guide page\n\n## Testing\n- Create test suite with known injection patterns\n- Include edge cases and evasion techniques\n- Benchmark false positive rate on legitimate content","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-14T22:08:12.266297987+01:00","updated_at":"2026-02-14T22:17:40.060645545+01:00","closed_at":"2026-02-14T22:17:40.060645545+01:00","close_reason":"Implemented prompt injection protection with 3-layer scoring system, username validation with generated name detection, and 3-second registration cooldown"}
{"id":"LATTICE-q88","title":"Hook notifications into reply creation","description":"Add notifyReply() call in content/service.ts when posts with parentId are created","status":"closed","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-15T16:41:06.916303006+01:00","created_by":"tcsenpai","updated_at":"2026-02-15T16:48:11.920875199+01:00","closed_at":"2026-02-15T16:48:11.920875199+01:00","close_reason":"Reply notifications hooked in content/service.ts","dependencies":[{"issue_id":"LATTICE-q88","depends_on_id":"LATTICE-4sj","type":"parent-child","created_at":"2026-02-15T16:41:31.964703241+01:00","created_by":"tcsenpai"},{"issue_id":"LATTICE-q88","depends_on_id":"LATTICE-88q","type":"blocks","created_at":"2026-02-15T16:41:39.524033151+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-qv0","title":"Hook notifications into follow and attestation","description":"Add notifyFollow() in agents.ts and notifyAttestation() in attestations.ts handlers","status":"closed","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-15T16:41:09.214507708+01:00","created_by":"tcsenpai","updated_at":"2026-02-15T16:48:11.962189704+01:00","closed_at":"2026-02-15T16:48:11.962189704+01:00","close_reason":"Follow and attestation notifications hooked","dependencies":[{"issue_id":"LATTICE-qv0","depends_on_id":"LATTICE-4sj","type":"parent-child","created_at":"2026-02-15T16:41:32.010006664+01:00","created_by":"tcsenpai"},{"issue_id":"LATTICE-qv0","depends_on_id":"LATTICE-88q","type":"blocks","created_at":"2026-02-15T16:41:39.562975794+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-ryz","title":"Quick win: add pagination metadata to list endpoints","description":"Enhance all paginated list endpoints to include pagination metadata (total count, has_more flag) for better client-side pagination handling.\n\n**Context** (Quick Win from Feedback):\n\"Pagination metadata (total count, has_more flag) on list endpoints\"\n\n**Implementation Requirements**:\n1. Add pagination metadata to all list endpoints:\n   - `GET /api/v1/feed` (all variants: home, discover, hot)\n   - `GET /api/v1/posts/:id/replies`\n   - `GET /api/v1/topics/trending`\n   - Any future list endpoints\n2. Include in response:\n   ```typescript\n   {\n     data: [...items],\n     pagination: {\n       limit: 20,\n       cursor: \"next_cursor_value\",\n       hasMore: true,\n       total: 150  // optional, may be expensive to compute\n     }\n   }\n   ```\n3. Balance accuracy vs performance for `total` count\n   - For feeds: consider approximation or omission (expensive)\n   - For smaller lists: include exact count\n4. Ensure hasMore is accurate (prevents unnecessary API calls)\n\n**Files to Modify**:\n- `src/api/handlers/feed.ts` - Add pagination metadata\n- `src/api/handlers/posts.ts` - Add to replies endpoint\n- `src/api/handlers/topics.ts` - Add to trending endpoint\n- `src/types/index.ts` - Add PaginatedResponse type\n\n**Success Criteria**:\n- All list endpoints include pagination object\n- hasMore flag is accurate\n- Client can determine if more pages exist without making extra calls\n- Documentation updated with pagination response format","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-14T17:00:37.021636596+01:00","updated_at":"2026-02-14T21:57:29.872137328+01:00","closed_at":"2026-02-14T21:57:29.872137328+01:00","close_reason":"Pagination metadata was already fully implemented. Agent verified all endpoints return PaginatedResponse with total, limit, offset, hasMore. Added comprehensive pagination documentation to AGENT-GUIDE.md. Minor TypeScript fixes applied."}
{"id":"LATTICE-s29","title":"Create notifications table schema","description":"Add notifications table to schema.sql with proper indexes","status":"closed","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-15T16:41:00.958675828+01:00","created_by":"tcsenpai","updated_at":"2026-02-15T16:43:05.221664498+01:00","closed_at":"2026-02-15T16:43:05.221664498+01:00","close_reason":"Schema added to schema.sql","dependencies":[{"issue_id":"LATTICE-s29","depends_on_id":"LATTICE-4sj","type":"parent-child","created_at":"2026-02-15T16:41:25.673376361+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-uf2","title":"(feat) add permalinks to comments","description":"## Feature: Comment Permalinks\n\n### Current Behavior\n- Posts have unique IDs accessible via `GET /api/v1/posts/:id`\n- Comments are posts with `parentId` set\n- No direct link to view a comment in context\n\n### Proposed Permalinks\n1. **API**: Comments already accessible via `GET /api/v1/posts/:commentId`\n2. **Web UI**: Add permalink icon next to each comment\n3. **URL Format**: `/posts/{parentId}#comment-{commentId}` or `/comments/{commentId}`\n\n### Files to Modify\n- `src/views/post.ejs`: Add permalink icon/button to comments\n- `src/web/routes.ts`: Add route for `/comments/:id` redirect to parent post\n- JavaScript to scroll to comment on page load\n\n### Implementation Notes\n- Permalink should highlight the specific comment\n- May need query param: `/posts/abc123?highlight=xyz789`\n- Copy-to-clipboard functionality for sharing","acceptance_criteria":"- [ ] Each comment displays a permalink icon\n- [ ] Clicking permalink copies URL to clipboard\n- [ ] Visiting permalink scrolls to and highlights comment\n- [ ] Works on both API and web UI","status":"open","priority":2,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-14T10:43:39.784629+01:00","created_by":"tcsenpai","updated_at":"2026-02-14T10:53:43.651518+01:00"}
{"id":"LATTICE-vkb","title":"Hook notifications into vote service","description":"Add notifyVote() call in vote-service.ts when votes are cast","status":"closed","priority":1,"issue_type":"task","owner":"tcsenpai@discus.sh","created_at":"2026-02-15T16:41:05.466848457+01:00","created_by":"tcsenpai","updated_at":"2026-02-15T16:48:11.877314005+01:00","closed_at":"2026-02-15T16:48:11.877314005+01:00","close_reason":"Vote notifications hooked in vote-service.ts","dependencies":[{"issue_id":"LATTICE-vkb","depends_on_id":"LATTICE-4sj","type":"parent-child","created_at":"2026-02-15T16:41:31.923621543+01:00","created_by":"tcsenpai"},{"issue_id":"LATTICE-vkb","depends_on_id":"LATTICE-88q","type":"blocks","created_at":"2026-02-15T16:41:39.485955025+01:00","created_by":"tcsenpai"}]}
{"id":"LATTICE-waz","title":"Design agent-first search engine","description":"Design a search system optimized for AI agent queries.\n\n## Requirements\n- **Fast**: Sub-100ms response for most queries\n- **Powerful**: Boolean operators, filters, field-specific search\n- **Fuzzy**: Typo tolerance, partial matching\n- **Semantic**: Meaning-based discovery, embeddings support\n- **Agent-first**: Programmatic API, structured responses, batch queries\n\n## Design Considerations\n- SQLite FTS5 for baseline full-text search\n- Optional: Vector embeddings for semantic search\n- Index strategy for posts, agents, topics\n- Query syntax for agent consumption\n- Pagination and result ranking","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-13T13:04:35.542999614+01:00","updated_at":"2026-02-13T13:04:35.542999614+01:00","labels":["design","phase-1.1","search"],"dependencies":[{"issue_id":"LATTICE-waz","depends_on_id":"LATTICE-3sz","type":"parent-child","created_at":"2026-02-13T13:04:47.828877201+01:00","created_by":"daemon"}]}
{"id":"LATTICE-wja","title":"Topic Following - Personalized Hashtag Feeds","description":"Allow agents to follow specific hashtags/topics and get a personalized feed filtered by their followed topics.\n\n## Core Requirements\n- Agents can follow/unfollow hashtags (e.g., #ai, #blockchain)\n- Personalized feed showing only posts with followed topics\n- API to manage followed topics\n- Web UI for topic management and filtered feed\n\n## Technical Approach\n1. New `topic_follows` table: id, did, topic, createdAt\n2. API endpoints:\n   - `POST /api/v1/topics/:topic/follow` - Follow a topic (auth required)\n   - `DELETE /api/v1/topics/:topic/follow` - Unfollow a topic\n   - `GET /api/v1/topics/following` - List followed topics\n   - `GET /api/v1/feed/topics` - Feed filtered by followed topics\n3. Extend existing topic system (`src/modules/content/topic-service.ts`):\n   - Already extracts hashtags from posts\n   - Already has `topics` and `post_topics` tables\n   - Add follow/unfollow operations\n4. Feed query modification:\n   - Join with topic_follows for authenticated requests\n   - Return posts matching ANY followed topic\n\n## Files to Create/Modify\n- `migrations/XXX_add_topic_follows.sql` - Schema\n- `src/modules/content/topic-service.ts` - Follow/unfollow logic\n- `src/api/handlers/topics.ts` - New endpoints\n- `src/api/handlers/feed.ts` - Filtered feed endpoint\n- `src/views/topics.ejs` - Topic management UI\n- `docs/AGENT-GUIDE.md` - Document topic following\n- `src/views/guide.ejs` - Update guide page\n\n## UI Considerations\n- \"Follow\" button on trending topics page\n- Visual indicator for followed topics\n- Separate feed view or filter toggle on main feed\n- Topic discovery from posts (click hashtag to view/follow)","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-14T22:07:57.724664309+01:00","updated_at":"2026-02-14T22:07:57.724664309+01:00"}
{"id":"LATTICE-x13","title":"Posts: implement edit and delete functionality","description":"Add ability for agents to edit or delete their own posts. Implement a 5-minute edit window to allow quick corrections without allowing abuse.\n\n**Context** (Feedback #4):\n\"No Edit or Delete for Posts - Once you post, it is permanent. Mistakes happen. Even a 5-minute edit window would be useful. Agents iterating on ideas should not be punished with duplicate posts just because of a typo.\"\n\n**Implementation Requirements**:\n1. Add `editedAt` timestamp field to posts table\n2. Add edit history tracking (optional: store original content hash)\n3. Implement `PATCH /api/v1/posts/:id` endpoint\n   - Verify post ownership (authorDid matches auth)\n   - Check edit window (\u003c 5 minutes since createdAt)\n   - Update content, set editedAt timestamp\n   - Return 403 if edit window expired\n4. Implement `DELETE /api/v1/posts/:id` endpoint\n   - Verify post ownership\n   - Set deleted flag or soft-delete\n   - Return 403 for posts with replies (preserve thread structure)\n5. Update web UI to show edit indicator\n6. Add rate limit: 1 edit per post, or separate edit action rate limit\n\n**Files to Modify**:\n- `src/db/schema.sql` - Add editedAt column\n- `src/api/handlers/posts.ts` - Add updatePost, deletePost handlers\n- `src/modules/content/service.ts` - Edit/delete business logic\n- `src/modules/content/repository.ts` - DB operations\n- `src/views/post.ejs` - Show edit indicator","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-14T16:59:48.732745075+01:00","updated_at":"2026-02-15T10:58:19.397289551+01:00","closed_at":"2026-02-15T10:58:19.397289551+01:00","close_reason":"Implemented post edit with 5-minute window and PATCH /posts/:id endpoint. Delete was already implemented. Updated guide.ejs documentation."}
{"id":"LATTICE-x6q","title":"(feat) Implement a hot reload system","description":"## Hot Reload Notification System (Cloudflare-style)\n\n**Goal**: Notify WebUI users when a new version is deployed so they can reload without hitting 500s.\n\n### Approach: Simple Version Polling (Option A)\n\n**How it works**:\n1. Server exposes `GET /api/v1/version` returning current build version\n2. Client polls every 60s (or on visibility change)\n3. If version changes → show toast \"New version available, click to reload\"\n4. User clicks → page reloads\n\n### Implementation Details\n\n**Backend** (`src/api/handlers/version.ts`):\n```typescript\n// Read version from package.json or env at startup\nconst APP_VERSION = process.env.npm_package_version || \"dev\";\n\nexport function getVersionHandler(req, res) {\n  res.json({ version: APP_VERSION, timestamp: Date.now() });\n}\n```\n\n**Frontend** (`src/public/js/version-check.js`):\n```javascript\nlet currentVersion = null;\n\nasync function checkVersion() {\n  const res = await fetch('/api/v1/version');\n  const { version } = await res.json();\n  \n  if (currentVersion === null) {\n    currentVersion = version;\n  } else if (currentVersion !== version) {\n    showUpdateToast();\n  }\n}\n\nfunction showUpdateToast() {\n  // Show non-intrusive toast with reload button\n}\n\n// Poll every 60s + on tab focus\nsetInterval(checkVersion, 60000);\ndocument.addEventListener('visibilitychange', () =\u003e {\n  if (!document.hidden) checkVersion();\n});\n```\n\n**Router** (`src/api/router.ts`):\n```typescript\nrouter.get(\"/version\", getVersionHandler);\n```\n\n### Files to Create/Modify\n- [ ] Create `src/api/handlers/version.ts`\n- [ ] Add route to `src/api/router.ts`\n- [ ] Create `src/public/js/version-check.js`\n- [ ] Include script in base layout template\n- [ ] Add toast styles to CSS\n\n### Constraints\n- Single server instance (no load balancer)\n- Passive notification (user clicks to reload)\n- Manual restart triggers version change\n- Keep it simple - no WebSocket needed","status":"open","priority":1,"issue_type":"feature","owner":"tcsenpai@discus.sh","created_at":"2026-02-13T17:34:34.795135859+01:00","created_by":"tcsenpai","updated_at":"2026-02-14T11:15:10.119751563+01:00"}
{"id":"LATTICE-x7h","title":"Quick win: add GET /api/v1/agents/me endpoint","description":"Add convenience endpoint for agents to retrieve their own profile without knowing their DID.\n\n**Context** (Quick Win from Feedback):\n\"A /api/v1/agents/me endpoint that returns your own profile using auth headers instead of needing your own DID\"\n\n**Implementation Requirements**:\n1. Add `GET /api/v1/agents/me` endpoint\n2. Use required authentication middleware\n3. Extract DID from auth headers (Authorization: Bearer signature)\n4. Return same response format as `GET /api/v1/agents/:did`\n5. Include all profile fields: username, level, totalEXP, etc.\n\n**Benefits**:\n- Simplifies agent client code (no need to store/track own DID)\n- Reduces API calls (don't need to parse DID from signature)\n- Common REST API pattern (most APIs have /me endpoints)\n\n**Files to Modify**:\n- `src/api/handlers/agents.ts` - Add getMeHandler\n- `src/api/router.ts` - Add route with requireAuth middleware\n\n**Success Criteria**:\n- Endpoint returns authenticated agent's profile\n- Returns 401 if not authenticated\n- Same response format as standard agent endpoint\n- Documented in API reference","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-14T17:00:25.22017412+01:00","updated_at":"2026-02-14T17:07:05.083941826+01:00","closed_at":"2026-02-14T17:07:05.083941826+01:00","close_reason":"Implemented GET /api/v1/agents/me convenience endpoint. Uses auth middleware to return own profile without needing to know DID."}
